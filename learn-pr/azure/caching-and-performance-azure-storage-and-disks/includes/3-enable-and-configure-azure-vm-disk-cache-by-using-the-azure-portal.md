<span data-ttu-id="fb46b-101">Vi har sett de inställningar och egenskaper som du kan välja för att förutsäga din diskprestanda. Nu ska vi titta på sätt att förbättra detta via _cachelagring_.</span><span class="sxs-lookup"><span data-stu-id="fb46b-101">We've seen settings and properties you can select to predict your disk performance, now let's look at ways to improve that through _caching_.</span></span>

## <a name="disk-caching"></a><span data-ttu-id="fb46b-102">Diskcachelagring</span><span class="sxs-lookup"><span data-stu-id="fb46b-102">Disk caching</span></span>

<span data-ttu-id="fb46b-103">En cache är en särskild komponent i en dator som lagrar data så att de kan nås snabbare, vanligtvis i minnet.</span><span class="sxs-lookup"><span data-stu-id="fb46b-103">A cache is a specialized component that stores data, typically in memory so that it can be accessed more quickly.</span></span> <span data-ttu-id="fb46b-104">Data i ett cacheminne är ofta data som tidigare har lästs eller data som kommer från en tidigare beräkning.</span><span class="sxs-lookup"><span data-stu-id="fb46b-104">The data in a cache is often data that has been read previously or is data that resulted from an earlier calculation.</span></span> <span data-ttu-id="fb46b-105">Målet är att komma åt data snabbare än om de läses från disken.</span><span class="sxs-lookup"><span data-stu-id="fb46b-105">The goal is to access data faster than getting it from disk.</span></span>

<span data-ttu-id="fb46b-106">Cachelagring använder specialiserad och ibland dyr tillfällig lagring som har snabbare prestanda för läsning och skrivning än vad permanent lagring har.</span><span class="sxs-lookup"><span data-stu-id="fb46b-106">Caching uses specialized, and sometimes expensive, temporary storage that has faster read and write performance than permanent storage.</span></span> <span data-ttu-id="fb46b-107">Eftersom den här cachelagringen ofta är begränsad behöver man bestämma vilka dataåtgärder som gagnas mest av cachelagring.</span><span class="sxs-lookup"><span data-stu-id="fb46b-107">Because this cache storage is often limited, decisions need to be made as to what data operations will benefit most from caching.</span></span> <span data-ttu-id="fb46b-108">Men även där cacheminne kan göras mycket tillgängligt, till exempel i Azure, är det fortfarande viktigt att känna till arbetsbelastningmönstren för varje disk innan du bestämmer vilken typ av cachelagring som ska användas.</span><span class="sxs-lookup"><span data-stu-id="fb46b-108">But even where the cache can be made widely available, such as in Azure, it's still important to know the workload patterns of each disk before deciding on what caching type to use.</span></span>

<span data-ttu-id="fb46b-109">**Cachelagring för läsning** försöker göra _datahämtning_ snabbare.</span><span class="sxs-lookup"><span data-stu-id="fb46b-109">**Read caching** tries to speed up data _retrieval_.</span></span> <span data-ttu-id="fb46b-110">I stället för att läsa från permanent lagring läses data från det snabbare cacheminnet.</span><span class="sxs-lookup"><span data-stu-id="fb46b-110">Instead of reading from permanent storage, the data is read from the faster cache.</span></span> <span data-ttu-id="fb46b-111">Dataläsning träffar cacheminnet under följande omständigheter:</span><span class="sxs-lookup"><span data-stu-id="fb46b-111">Data reads hit the cache under the following conditions:</span></span>

- <span data-ttu-id="fb46b-112">Data har lästs in förut och finns i cacheminnet.</span><span class="sxs-lookup"><span data-stu-id="fb46b-112">The data has been read before and exists in the cache.</span></span>
- <span data-ttu-id="fb46b-113">Cacheminnet är tillräckligt stort för att rymma alla dessa data.</span><span class="sxs-lookup"><span data-stu-id="fb46b-113">And the cache is large enough to hold all of this data.</span></span>

<span data-ttu-id="fb46b-114">Observera att cachelagring för läsning fungerar när det finns viss _förutsägbarhet_ i läsningskön, till exempel en uppsättning sekventiella läsåtgärder.</span><span class="sxs-lookup"><span data-stu-id="fb46b-114">It's important to note that read caching helps when there is some _predictability_ to the read queue, such as a set of sequential reads.</span></span> <span data-ttu-id="fb46b-115">För slumpmässig I/O, där de data som du läser är spridda över lagringen, finns det få eller inga fördelar med cachelagring, och det kan till och med minska diskprestanda.</span><span class="sxs-lookup"><span data-stu-id="fb46b-115">For random I/O, where the data you're accessing is scattered across storage, caching will be of little or no benefit, and can even reduce disk performance.</span></span>

<span data-ttu-id="fb46b-116">**Cachelagring för skrivning** försöker göra _dataskrivning_ till beständig lagring snabbare.</span><span class="sxs-lookup"><span data-stu-id="fb46b-116">**Write caching** tries to speed up _writing data_ to persistent storage.</span></span> <span data-ttu-id="fb46b-117">Genom att använda en cachelagring för skrivning kan appen överväga de data som ska sparas.</span><span class="sxs-lookup"><span data-stu-id="fb46b-117">By using a write cache, the app can consider the data to be saved.</span></span> <span data-ttu-id="fb46b-118">I verkligheten placeras data i kö i ett cacheminne som väntar på att skrivas till disk.</span><span class="sxs-lookup"><span data-stu-id="fb46b-118">In reality, the data is queued up in a cache, waiting to be written to disk.</span></span> <span data-ttu-id="fb46b-119">Den här mekanismen är en potentiell källa till fel, till exempel om systemet stängs ned innan dessa cachelagrade data skrivs.</span><span class="sxs-lookup"><span data-stu-id="fb46b-119">As you can imagine, this mechanism can be a potential point of failure, for example, if the system shuts down before the cached data is written.</span></span> <span data-ttu-id="fb46b-120">Vissa system, till exempel SQL Server, hanterar själva skrivning av cachelagrade data till beständig disklagring.</span><span class="sxs-lookup"><span data-stu-id="fb46b-120">Some systems, such as SQL Server, handle writing cached data to persistent disk storage themselves.</span></span>

### <a name="azure-disk-caching"></a><span data-ttu-id="fb46b-121">Azure-diskcachelagring</span><span class="sxs-lookup"><span data-stu-id="fb46b-121">Azure disk caching</span></span>

<span data-ttu-id="fb46b-122">Det finns två typer av diskcachelagring som berör disklagring:</span><span class="sxs-lookup"><span data-stu-id="fb46b-122">There are two types of disk caching that concern disk storage:</span></span>

- <span data-ttu-id="fb46b-123">Azure-cachelagring</span><span class="sxs-lookup"><span data-stu-id="fb46b-123">Azure storage caching</span></span>
- <span data-ttu-id="fb46b-124">Diskcachelagring för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="fb46b-124">Azure virtual machine (VM) disk caching</span></span>

<span data-ttu-id="fb46b-125">Azure-cachelagring tillhandahåller cachelagringstjänster för Azure Blob-lagring, Azure Files och annat innehåll i Azure.</span><span class="sxs-lookup"><span data-stu-id="fb46b-125">Azure storage caching provides cache services for Azure Blob storage, Azure Files, and other content in Azure.</span></span> <span data-ttu-id="fb46b-126">Konfiguration av dessa cachetyper ligger inte inom ramen för den här modulen.</span><span class="sxs-lookup"><span data-stu-id="fb46b-126">Configuration of these types of cache is beyond the scope of this module.</span></span>

<span data-ttu-id="fb46b-127">Diskcachelagring för virtuella Azure-datorer handlar om att optimera läs- och skrivåtkomst till de virtuell hårddiskfiler (VHD) som ansluts till virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="fb46b-127">Azure virtual machine disk caching is about optimizing read and write access to the virtual hard disk (VHD) files attached to Azure VMs.</span></span> <span data-ttu-id="fb46b-128">Vi fokuserar på diskcachelagring i den här modulen.</span><span class="sxs-lookup"><span data-stu-id="fb46b-128">We'll focus on disk caching in this module.</span></span>

### <a name="azure-virtual-machine-disk-types"></a><span data-ttu-id="fb46b-129">Disklagringstyper för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="fb46b-129">Azure virtual machine disk types</span></span>

<span data-ttu-id="fb46b-130">Det finns tre typer av diskar som används med virtuella Azure-datorer:</span><span class="sxs-lookup"><span data-stu-id="fb46b-130">There are three types of disks used with Azure VMs:</span></span>

- <span data-ttu-id="fb46b-131">**OS-disk**: när du skapar en virtuell Azure-dator ansluter Azure automatiskt en virtuell hårddisk för operativsystemet (OS).</span><span class="sxs-lookup"><span data-stu-id="fb46b-131">**OS disk**: When you create an Azure VM, Azure automatically attaches a VHD for the operating system (OS).</span></span>

- <span data-ttu-id="fb46b-132">**Tillfällig disk**: när du skapar en virtuell Azure-dator lägger Azure även automatiskt till en tillfällig disk.</span><span class="sxs-lookup"><span data-stu-id="fb46b-132">**Temporary disk**: When you create an Azure VM, Azure also automatically adds a temporary disk.</span></span> <span data-ttu-id="fb46b-133">Den här disken används för data, till exempel sido- och växlingsfiler.</span><span class="sxs-lookup"><span data-stu-id="fb46b-133">This disk is used for data, such as page and swap files.</span></span> <span data-ttu-id="fb46b-134">Data på den här disken kan gå förlorade under underhåll eller vid omdistribuering av en virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="fb46b-134">The data on this disk may be lost during maintenance, or a VM redeploy.</span></span> <span data-ttu-id="fb46b-135">Därför bör du inte använda den för att lagra permanenta data såsom databasfiler eller transaktionsloggar.</span><span class="sxs-lookup"><span data-stu-id="fb46b-135">So, don't use it for storing permanent data, such as database files or transaction logs.</span></span>

- <span data-ttu-id="fb46b-136">**Datadiskar**: en datadisk är en virtuell hårddisk som är ansluten till en virtuell dator för att lagra programdata eller andra data som du behöver bevara.</span><span class="sxs-lookup"><span data-stu-id="fb46b-136">**Data disks**: A data disk is a VHD that's attached to a virtual machine to store application data or other data you need to keep.</span></span>

<span data-ttu-id="fb46b-137">OS-diskar och datadiskar drar nytta av diskcachelagring för virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="fb46b-137">OS disks and data disks take advantage of Azure VM disk caching.</span></span> <span data-ttu-id="fb46b-138">Cachestorleken för en virtuell datordisk beror på VM-instansens storlek och antalet diskar som monterats på den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="fb46b-138">The cache size for a VM disk depends on the VM instance size and the number of disks mounted on the VM.</span></span> <span data-ttu-id="fb46b-139">Cachelagring kan bara aktiveras för upp till fyra datadiskar.</span><span class="sxs-lookup"><span data-stu-id="fb46b-139">Caching can be enabled for only up to four data disks.</span></span>

## <a name="cache-options-for-azure-vms"></a><span data-ttu-id="fb46b-140">Cachelagringsalternativ för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="fb46b-140">Cache options for Azure VMs</span></span>

<span data-ttu-id="fb46b-141">Det finns tre vanliga alternativ för VM-diskcachelagring:</span><span class="sxs-lookup"><span data-stu-id="fb46b-141">There are three common options for VM disk caching:</span></span>

- <span data-ttu-id="fb46b-142">**Läsa/skriva** – återskrivningscache.</span><span class="sxs-lookup"><span data-stu-id="fb46b-142">**Read/write** – Write-back cache.</span></span> <span data-ttu-id="fb46b-143">Använd bara det här alternativet om programmet hanterar skrivning av cachelagrade data till beständiga diskar när det behövs.</span><span class="sxs-lookup"><span data-stu-id="fb46b-143">Use this option only if your application properly handles writing cached data to persistent disks when needed.</span></span>
- <span data-ttu-id="fb46b-144">**Skrivskyddad** – läsningar sker från cachen.</span><span class="sxs-lookup"><span data-stu-id="fb46b-144">**Read-only** - Reads are done from cache.</span></span>
- <span data-ttu-id="fb46b-145">**Ingen** – ingen cachelagring.</span><span class="sxs-lookup"><span data-stu-id="fb46b-145">**None** - No cache.</span></span> <span data-ttu-id="fb46b-146">Välj det här alternativet för lässkyddade och skrivintensiva diskar.</span><span class="sxs-lookup"><span data-stu-id="fb46b-146">Select this option for write-only and write-heavy disks.</span></span> <span data-ttu-id="fb46b-147">Loggfiler är ett bra alternativ eftersom de är skrivintensiva åtgärder.</span><span class="sxs-lookup"><span data-stu-id="fb46b-147">Log files are a good candidate because they're write-heavy operations.</span></span>

<span data-ttu-id="fb46b-148">Inte alla cachelagringsalternativet är tillgängliga för alla disktyper.</span><span class="sxs-lookup"><span data-stu-id="fb46b-148">Not every caching option is available for each type of disk.</span></span> <span data-ttu-id="fb46b-149">I följande tabell visas cachelagringsalternativen för varje disktyp:</span><span class="sxs-lookup"><span data-stu-id="fb46b-149">The following table shows you the caching options for each disk type:</span></span>

|               | <span data-ttu-id="fb46b-150">**Skrivskyddad**</span><span class="sxs-lookup"><span data-stu-id="fb46b-150">**Read-only**</span></span>  | <span data-ttu-id="fb46b-151">**Läsa/skriva**</span><span class="sxs-lookup"><span data-stu-id="fb46b-151">**Read/write**</span></span> | <span data-ttu-id="fb46b-152">**Ingen**</span><span class="sxs-lookup"><span data-stu-id="fb46b-152">**None**</span></span> |
|---------------|----------------|----------------|----------|
| <span data-ttu-id="fb46b-153">OS-disk</span><span class="sxs-lookup"><span data-stu-id="fb46b-153">OS disk</span></span>       | <span data-ttu-id="fb46b-154">ja</span><span class="sxs-lookup"><span data-stu-id="fb46b-154">yes</span></span>            | <span data-ttu-id="fb46b-155">ja (standard)</span><span class="sxs-lookup"><span data-stu-id="fb46b-155">yes (default)</span></span>  | <span data-ttu-id="fb46b-156">ja</span><span class="sxs-lookup"><span data-stu-id="fb46b-156">yes</span></span>      |
| <span data-ttu-id="fb46b-157">Datadisk</span><span class="sxs-lookup"><span data-stu-id="fb46b-157">Data disk</span></span>     | <span data-ttu-id="fb46b-158">ja (standard)</span><span class="sxs-lookup"><span data-stu-id="fb46b-158">yes (default)</span></span>  | <span data-ttu-id="fb46b-159">ja</span><span class="sxs-lookup"><span data-stu-id="fb46b-159">yes</span></span>            | <span data-ttu-id="fb46b-160">ja</span><span class="sxs-lookup"><span data-stu-id="fb46b-160">yes</span></span>      |
| <span data-ttu-id="fb46b-161">Temporär disk</span><span class="sxs-lookup"><span data-stu-id="fb46b-161">Temp disk</span></span>     | <span data-ttu-id="fb46b-162">nej</span><span class="sxs-lookup"><span data-stu-id="fb46b-162">no</span></span>             | <span data-ttu-id="fb46b-163">nej</span><span class="sxs-lookup"><span data-stu-id="fb46b-163">no</span></span>             | <span data-ttu-id="fb46b-164">nej</span><span class="sxs-lookup"><span data-stu-id="fb46b-164">no</span></span>       |

> [!NOTE]
> <span data-ttu-id="fb46b-165">Alternativen för diskcachelagring kan inte ändras för virtuella datorer i **L-serien** och **B-serien**.</span><span class="sxs-lookup"><span data-stu-id="fb46b-165">Disk caching options can't be changed for **L-Series** and **B-series** virtual machines.</span></span>

## <a name="performance-considerations-for-azure-vm-disk-caching"></a><span data-ttu-id="fb46b-166">Prestandaöverväganden för diskcachelagring för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="fb46b-166">Performance considerations for Azure VM disk caching</span></span>

<span data-ttu-id="fb46b-167">Hur kan då dina cacheinställningar påverka prestanda för de arbetsbelastningar som körs på virtuella Azure-datorer?</span><span class="sxs-lookup"><span data-stu-id="fb46b-167">So, how can your cache settings affect the performance of your workloads running on Azure VMs?</span></span>

### <a name="os-disk"></a><span data-ttu-id="fb46b-168">OS-disk</span><span class="sxs-lookup"><span data-stu-id="fb46b-168">OS disk</span></span>

<span data-ttu-id="fb46b-169">För en OS-disk för en virtuell dator är standardbeteendet att använda cachelagring i läget Läsa/skriva.</span><span class="sxs-lookup"><span data-stu-id="fb46b-169">For a VM OS disk, the default behavior is to use the cache in read/write mode.</span></span> <span data-ttu-id="fb46b-170">Om du har program som lagrar datafiler på OS-disken och programmen utför många slumpmässiga läs-/skrivåtgärder till datafiler bör du överväga att flytta de filerna till en datadisk som har cachelagring inaktiverat.</span><span class="sxs-lookup"><span data-stu-id="fb46b-170">If you have applications that store data files on the OS disk, and the apps do lots of random read/write operations to data files, consider moving those files to a data disk that has the caching turned off.</span></span> <span data-ttu-id="fb46b-171">Vad beror det på?</span><span class="sxs-lookup"><span data-stu-id="fb46b-171">Why is that?</span></span> <span data-ttu-id="fb46b-172">Det beror på att om läsningskön inte innehåller sekventiella läsåtgärder så finns det få eller inga fördelar med cachelagring.</span><span class="sxs-lookup"><span data-stu-id="fb46b-172">Well, if the read queue does not contain sequential reads, caching will be of little or no benefit.</span></span> <span data-ttu-id="fb46b-173">Arbetet med att underhålla cacheminnet som om data vore sekventiella kan minska diskprestanda.</span><span class="sxs-lookup"><span data-stu-id="fb46b-173">The overhead of maintaining the cache, as if the data was sequential, can reduce disk performance.</span></span>

### <a name="data-disks"></a><span data-ttu-id="fb46b-174">Datadiskar</span><span class="sxs-lookup"><span data-stu-id="fb46b-174">Data disks</span></span>

<span data-ttu-id="fb46b-175">För prestandakänsliga program bör du använda datadiskar i stället för OS-disken.</span><span class="sxs-lookup"><span data-stu-id="fb46b-175">For performance-sensitive applications, you should use data disks rather than the OS disk.</span></span> <span data-ttu-id="fb46b-176">Med hjälp av separata diskar kan du konfigurera lämpliga cacheinställningar för varje.</span><span class="sxs-lookup"><span data-stu-id="fb46b-176">Using separate disks allows you to configure the appropriate cache settings for each one.</span></span>

<span data-ttu-id="fb46b-177">Till exempel: om du aktiverar **Skrivskyddad** cachelagring för datadiskarna för virtuella Azure-datorer som kör SQL Server kan det resultera i avsevärda prestandaförbättringar.</span><span class="sxs-lookup"><span data-stu-id="fb46b-177">For example, on Azure VMs running SQL Server, enabling **Read-only** caching on the data disks (for regular and TempDB data) can result in significant performance improvements.</span></span> <span data-ttu-id="fb46b-178">Loggfiler å andra sidan är bra kandidater för datadiskar utan cachelagring.</span><span class="sxs-lookup"><span data-stu-id="fb46b-178">Log files, on the other hand, are good candidates for data disks with no caching.</span></span>

> [!WARNING]
> <span data-ttu-id="fb46b-179">När du ändrar cacheinställningen för en Azure-disk så frånkopplas och återansluts måldisken.</span><span class="sxs-lookup"><span data-stu-id="fb46b-179">Changing the cache setting of an Azure disk detaches and then reattaches the target disk.</span></span> <span data-ttu-id="fb46b-180">Om det är operativsystemdisken startas den virtuella datorn om.</span><span class="sxs-lookup"><span data-stu-id="fb46b-180">If it's the operating system disk, the VM is restarted.</span></span> <span data-ttu-id="fb46b-181">Stoppa alla program/tjänster som kan påverkas av det här avbrottet innan du ändrar inställningen för diskcachelagring.</span><span class="sxs-lookup"><span data-stu-id="fb46b-181">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span></span>

<span data-ttu-id="fb46b-182">Du kan konfigurera inställningar för virtuell datorcachelagring med något av följande verktyg:</span><span class="sxs-lookup"><span data-stu-id="fb46b-182">You can configure virtual machine disk cache settings with any of the following tools:</span></span>

- <span data-ttu-id="fb46b-183">Azure-portalen</span><span class="sxs-lookup"><span data-stu-id="fb46b-183">Azure portal</span></span>
- <span data-ttu-id="fb46b-184">Azure CLI</span><span class="sxs-lookup"><span data-stu-id="fb46b-184">Azure CLI</span></span>
- <span data-ttu-id="fb46b-185">Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="fb46b-185">Azure PowerShell</span></span>
- <span data-ttu-id="fb46b-186">Resource Manager-mallar</span><span class="sxs-lookup"><span data-stu-id="fb46b-186">Resource Manager templates</span></span>

## <a name="using-the-azure-portal-to-configure-caching"></a><span data-ttu-id="fb46b-187">Konfigurera cachelagring med hjälp av Azure-portalen</span><span class="sxs-lookup"><span data-stu-id="fb46b-187">Using the Azure portal to configure caching</span></span>

<span data-ttu-id="fb46b-188">När du etablerar en ny virtuell dator med hjälp av Azure-portalen kan du inte ändra standardkonfigurationen för cachelagring för OS-disken från Läsa/skriva förrän den virtuella datorn har distribuerats.</span><span class="sxs-lookup"><span data-stu-id="fb46b-188">When you provision a new VM using the Azure portal, you can't change the default caching configuration for the OS disk from read/write until the VM is deployed.</span></span>

<span data-ttu-id="fb46b-189">När du lägger till en datadisk till en befintlig virtuell dator kan du konfigurera cachelagringsalternativet innan disken distribueras till den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="fb46b-189">When you add a data disk to an existing VM, you can configure the cache option before the disk is deployed to the VM.</span></span>

<span data-ttu-id="fb46b-190">När du ändrar cacheinställningen för en Azure-disk så frånkopplas och återansluts måldisken.</span><span class="sxs-lookup"><span data-stu-id="fb46b-190">Changing the cache setting of an Azure disk detaches and reattaches the target disk.</span></span> <span data-ttu-id="fb46b-191">Om det är operativsystemdisken startas den virtuella datorn om.</span><span class="sxs-lookup"><span data-stu-id="fb46b-191">If it's the operating system disk, the VM is restarted.</span></span> <span data-ttu-id="fb46b-192">Stoppa alla program/tjänster som kan påverkas av det här avbrottet innan du ändrar inställningen för diskcachelagring.</span><span class="sxs-lookup"><span data-stu-id="fb46b-192">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span></span>

<span data-ttu-id="fb46b-193">Nu skapar vi en virtuell dator och ändrar inställningar för cachelagring med hjälp av Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="fb46b-193">Let's create a VM and change the cache settings using the Azure portal.</span></span>
