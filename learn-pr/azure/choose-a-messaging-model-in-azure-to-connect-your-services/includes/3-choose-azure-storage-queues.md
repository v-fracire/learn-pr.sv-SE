<span data-ttu-id="8edf8-101">Anta att du planerar arkitekturen för ditt musikdelningsprogram.</span><span class="sxs-lookup"><span data-stu-id="8edf8-101">Suppose you are planning the architecture for your music-sharing application.</span></span> <span data-ttu-id="8edf8-102">Du vill säkerställa att musikfilerna överförs till webb-API:et på ett tillförlitligt sätt från den mobila appen – sedan ska informationen om de nya låtarna levereras direkt till appen när en artist lägger till ny musik i sin samling.</span><span class="sxs-lookup"><span data-stu-id="8edf8-102">You want to ensure that music files are uploaded to the web API reliably from the mobile app - we then want to deliver the details about new songs directly to the app when an artist adds new music to their collection.</span></span> <span data-ttu-id="8edf8-103">Det här är ett perfekt användningsområde för ett meddelandebaserat system. Azure erbjuder två lösningar på det här problemet:</span><span class="sxs-lookup"><span data-stu-id="8edf8-103">This is a perfect use of a message-based system and Azure offers two solutions to this problem:</span></span>

- <span data-ttu-id="8edf8-104">Azure Queue Storage</span><span class="sxs-lookup"><span data-stu-id="8edf8-104">Azure Queue Storage</span></span>
- <span data-ttu-id="8edf8-105">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="8edf8-105">Azure Service Bus</span></span>

## <a name="what-is-azure-queue-storage"></a><span data-ttu-id="8edf8-106">Vad är Azure Queue Storage?</span><span class="sxs-lookup"><span data-stu-id="8edf8-106">What is Azure Queue Storage?</span></span>
<span data-ttu-id="8edf8-107">Queue Storage är en tjänst som använder Azure Storage för att lagra stora mängder meddelanden som på ett säkert sätt kan nås från var som helst i världen med ett enkelt REST-baserat gränssnitt.</span><span class="sxs-lookup"><span data-stu-id="8edf8-107">Queue storage is a service that uses Azure Storage to store large numbers of messages that can be securely accessed from anywhere in the world using a simple REST-based interface.</span></span> <span data-ttu-id="8edf8-108">Köer kan innehålla miljontals meddelanden; en kö begränsas bara av kapaciteten hos det lagringskonto som äger kön.</span><span class="sxs-lookup"><span data-stu-id="8edf8-108">Queues can contain millions of messages, limited only by the capacity of the storage account that owns it.</span></span>

## <a name="what-is-azure-service-bus-queues"></a><span data-ttu-id="8edf8-109">Vad är Azure Service Bus Queues?</span><span class="sxs-lookup"><span data-stu-id="8edf8-109">What is Azure Service Bus Queues?</span></span>
<span data-ttu-id="8edf8-110">Service Bus är ett system för asynkron meddelandekö som är avsett för företagsprogram.</span><span class="sxs-lookup"><span data-stu-id="8edf8-110">Service Bus is a message broker system intended for enterprise applications.</span></span> <span data-ttu-id="8edf8-111">De här apparna använder ofta flera kommunikationsprotokoll, har olika datakontrakt, högre säkerhetskrav och kan innehålla både molnbaserade och lokala tjänster.</span><span class="sxs-lookup"><span data-stu-id="8edf8-111">These apps often utilize multiple communication protocols, have different data contracts, higher security requirements, and can include both cloud and on-premises services.</span></span> <span data-ttu-id="8edf8-112">Service Bus är byggt ovanpå en dedikerad meddelandeinfrastruktur som har utformats för just dessa scenarier.</span><span class="sxs-lookup"><span data-stu-id="8edf8-112">Service Bus is built on top of a dedicated messaging infrastructure designed for exactly these scenarios.</span></span>

<span data-ttu-id="8edf8-113">Båda tjänsterna baseras på konceptet med en ”kö” som kvarhåller skickade meddelanden tills målet är redo att ta emot dem.</span><span class="sxs-lookup"><span data-stu-id="8edf8-113">Both of these services are based on the idea of a "queue" which holds sent messages until the target is ready to receive them.</span></span>

## <a name="what-are-azure-service-bus-topics"></a><span data-ttu-id="8edf8-114">Vad är Azure Service Bus-ämnen?</span><span class="sxs-lookup"><span data-stu-id="8edf8-114">What are Azure Service Bus Topics?</span></span>
<span data-ttu-id="8edf8-115">Azure Service Bus-ämnen liknar köer, men kan ha flera prenumeranter.</span><span class="sxs-lookup"><span data-stu-id="8edf8-115">Azure Service Bus topics are like queues, but can have multiple subscribers.</span></span> <span data-ttu-id="8edf8-116">När ett meddelande skickas till ett ämne i stället för en kö kan flera komponenter aktiveras för att utföra deras arbete.</span><span class="sxs-lookup"><span data-stu-id="8edf8-116">When a message is sent to a topic instead of a queue multiple components can be triggered to do their work.</span></span> <span data-ttu-id="8edf8-117">Föreställ dig en musikdelningsprogram där en användare lyssnar på en låt.</span><span class="sxs-lookup"><span data-stu-id="8edf8-117">Imagine in a music sharing application, a user listening to a song.</span></span> <span data-ttu-id="8edf8-118">Mobilappen kan skicka ett meddelande till ämnet ”Listened”.</span><span class="sxs-lookup"><span data-stu-id="8edf8-118">The mobile app might send a message to the "Listened" topic.</span></span> <span data-ttu-id="8edf8-119">Detta ämne har en prenumeration för ”UpdateUserListenHistory” och en annan prenumeration för ”UpdateArtistsFanList”.</span><span class="sxs-lookup"><span data-stu-id="8edf8-119">That topic will have a subscription for "UpdateUserListenHistory" and a different subscription for "UpdateArtistsFanList".</span></span> <span data-ttu-id="8edf8-120">Var och en av dessa funktioner hanteras av olika komponenter som tar emot en egen kopia av meddelandet.</span><span class="sxs-lookup"><span data-stu-id="8edf8-120">Each of those functions is handled by a different component that receives its own copy of the message.</span></span>

<span data-ttu-id="8edf8-121">Internt används köer för ämnen.</span><span class="sxs-lookup"><span data-stu-id="8edf8-121">Internally, topics use queues.</span></span> <span data-ttu-id="8edf8-122">När du publicerar på ett ämne kopieras meddelandet och släpps i kön för varje prenumeration.</span><span class="sxs-lookup"><span data-stu-id="8edf8-122">When you post to a topic, the message is copied and dropped into the queue for each subscription.</span></span> <span data-ttu-id="8edf8-123">Kön innebär att meddelandekopian blir kvar för att bearbetas **av varje prenumerationsgren** även om den komponent som bearbetar prenumerationen är för upptagen för att hinna med.</span><span class="sxs-lookup"><span data-stu-id="8edf8-123">The queue means that the message copy will stay around to be processed **by each subscription branch** even if the component processing that subscription is too busy to keep up.</span></span>

## <a name="benefits-of-queues"></a><span data-ttu-id="8edf8-124">Fördelarna med köer</span><span class="sxs-lookup"><span data-stu-id="8edf8-124">Benefits of queues</span></span>
<span data-ttu-id="8edf8-125">Köinfrastrukturer har stöd för många avancerade funktioner som gör dem mycket användbara i</span><span class="sxs-lookup"><span data-stu-id="8edf8-125">Queue infrastructures can support many advanced features that make them very useful in</span></span> 

### <a name="increased-reliability"></a><span data-ttu-id="8edf8-126">Ökad tillförlitlighet</span><span class="sxs-lookup"><span data-stu-id="8edf8-126">Increased reliability</span></span>
<span data-ttu-id="8edf8-127">Köer används av distribuerade program som en tillfällig lagringsplats för meddelanden som väntar på leverans till en målkomponent.</span><span class="sxs-lookup"><span data-stu-id="8edf8-127">Queues are used by distributed applications as a temporary storage location for messages pending delivery to a destination component.</span></span> <span data-ttu-id="8edf8-128">Källkomponenten kan lägga till ett meddelande till kön, och målkomponenter kan hämta meddelandet längst fram i kön för bearbetning.</span><span class="sxs-lookup"><span data-stu-id="8edf8-128">The source component can add a message to the queue and destination components can retrieve the message at the front of the queue for processing.</span></span> <span data-ttu-id="8edf8-129">Köer ökar tillförlitligheten för meddelanden eftersom det vid hög efterfrågan kan innebära att meddelanden får vänta tills en målkomponent är redo att bearbeta dem.</span><span class="sxs-lookup"><span data-stu-id="8edf8-129">Queues increase the reliability of the message exchange because, at times of high demand, messages can simply wait until a destination component is ready to process them.</span></span>

### <a name="message-delivery-guarantees"></a><span data-ttu-id="8edf8-130">Garantier för meddelandeleverans</span><span class="sxs-lookup"><span data-stu-id="8edf8-130">Message delivery guarantees</span></span>
<span data-ttu-id="8edf8-131">Kösystem garanterar vanligtvis att alla meddelanden i kön levereras till en målkomponent.</span><span class="sxs-lookup"><span data-stu-id="8edf8-131">Queuing systems usually guarantee delivery of each message in the queue to a destination component.</span></span> <span data-ttu-id="8edf8-132">Dessa garantier kan dock fungera på olika sätt:</span><span class="sxs-lookup"><span data-stu-id="8edf8-132">However, these guarantees can take different approaches:</span></span>

- <span data-ttu-id="8edf8-133">**Leverans minst en gång:** Den här metoden garanterar att varje meddelande levereras till minst en av de komponenter som hämtar meddelanden från kön.</span><span class="sxs-lookup"><span data-stu-id="8edf8-133">**At-Least-Once Delivery:** In this approach, each message is guaranteed to be delivered to at least one of the components that retrieve messages from the queue.</span></span> <span data-ttu-id="8edf8-134">Observera att det i vissa fall kan hända att samma meddelande levereras mer än en gång.</span><span class="sxs-lookup"><span data-stu-id="8edf8-134">Note, however, that in certain circumstances, it is possible that the same message may be delivered more than once.</span></span> <span data-ttu-id="8edf8-135">Om det till exempel finns två instanser av en webbapp som hämtar meddelanden från en kö skickas vanligtvis varje meddelande till endast en av dessa instanser.</span><span class="sxs-lookup"><span data-stu-id="8edf8-135">For example, if there are two instances of a web app retrieving messages from a queue, ordinarily each message goes to only one of those instances.</span></span> <span data-ttu-id="8edf8-136">Men om det tar lång tid för en instans att bearbeta meddelandet och en tidsgräns går ut kan meddelandet skickas till den andra instansen också.</span><span class="sxs-lookup"><span data-stu-id="8edf8-136">However, if one instance takes a long time to process the message, and a time-out expires, the message may be sent to the other instance as well.</span></span> <span data-ttu-id="8edf8-137">Koden i din webbapp bör utformas för att ta hänsyn till den här möjligheten.</span><span class="sxs-lookup"><span data-stu-id="8edf8-137">Your web app code should be designed with this possibility in mind.</span></span>

- <span data-ttu-id="8edf8-138">**Leverans högst en gång** Med den här metoden går det inte att garantera att varje meddelande levereras, och det finns en mycket liten risk att det inte kommer fram alls.</span><span class="sxs-lookup"><span data-stu-id="8edf8-138">**At-Most-Once Delivery:** In this approach, each message is not guaranteed to be delivered, and there is a very small chance that it may not arrive.</span></span> <span data-ttu-id="8edf8-139">Till skillnad från hur alternativet ”Leverans minst en gång” fungerar finns det dock ingen risk att meddelandet levereras två gånger.</span><span class="sxs-lookup"><span data-stu-id="8edf8-139">However, unlike At-Least-Once delivery, there is no chance that the message will be delivered twice.</span></span> <span data-ttu-id="8edf8-140">Detta kallas ibland ”automatisk dubblettidentifiering”.</span><span class="sxs-lookup"><span data-stu-id="8edf8-140">This is sometimes referred to as "automatic duplicate detection".</span></span>

- <span data-ttu-id="8edf8-141">**Först in, först ut (FIFO):** I de flesta meddelandesystem lämnar meddelanden vanligtvis kön i samma ordning som de har lagts till, men du bör fundera på om den här ordningen ska vara garanterad.</span><span class="sxs-lookup"><span data-stu-id="8edf8-141">**First-In-First-Out (FIFO):** In most messaging systems, messages usually leave the queue in the same order in which they were added, but you should consider whether this order is guaranteed.</span></span> <span data-ttu-id="8edf8-142">Om det distribuerade programmet kräver att meddelanden behandlas i exakt rätt ordning måste du välja ett kösystem med FIFO-garanti.</span><span class="sxs-lookup"><span data-stu-id="8edf8-142">If your distributed application requires that messages are processed in precisely the correct order, you must choose a queue system that includes a FIFO guarantee.</span></span>

### <a name="transactional-support"></a><span data-ttu-id="8edf8-143">Transaktionsstöd</span><span class="sxs-lookup"><span data-stu-id="8edf8-143">Transactional support</span></span>
<span data-ttu-id="8edf8-144">Vissa nära relaterade grupper av meddelanden kan orsaka problem om leveransen misslyckas för ett av meddelandena i gruppen.</span><span class="sxs-lookup"><span data-stu-id="8edf8-144">Some closely related groups of messages may cause problems when delivery fails for one message in the group.</span></span>

<span data-ttu-id="8edf8-145">Tänk dig exempelvis ett e-handelsprogram.</span><span class="sxs-lookup"><span data-stu-id="8edf8-145">For example, consider an e-commerce application.</span></span> <span data-ttu-id="8edf8-146">När användaren klickar på knappen **Köp** genereras kanske en serie meddelanden och skickas till olika bearbetningsmål:</span><span class="sxs-lookup"><span data-stu-id="8edf8-146">When the user clicks the **Buy** button, a series of messages might be generated and sent off to various processing destinations:</span></span>

- <span data-ttu-id="8edf8-147">Ett meddelande med orderinformationen skickas till en expedieringscentral</span><span class="sxs-lookup"><span data-stu-id="8edf8-147">A message with the order details is sent to a fulfillment center</span></span>
- <span data-ttu-id="8edf8-148">Ett meddelande med information om totalsumman och betalningen skickas till ett kreditkortsföretag.</span><span class="sxs-lookup"><span data-stu-id="8edf8-148">A message with the total and payment details is sent to a credit card processor.</span></span> 
- <span data-ttu-id="8edf8-149">Ett meddelande med kvittoinformationen skickas till en databas för att generera en faktura för kunden</span><span class="sxs-lookup"><span data-stu-id="8edf8-149">A message with the receipt information is sent to a database to generate an invoice for the customer</span></span>

<span data-ttu-id="8edf8-150">I det här fallet vi vill vara säkra på att _alla_ meddelanden bearbetas eller att inga av dem bearbetas.</span><span class="sxs-lookup"><span data-stu-id="8edf8-150">In this case, we want to make sure _all_ messages get processed, or none of them are processed.</span></span> <span data-ttu-id="8edf8-151">Det skulle orsaka en hel del problem om kreditkortsmeddelandet inte levererades och alla våra beställningar slutfördes utan betalning!</span><span class="sxs-lookup"><span data-stu-id="8edf8-151">We won't be in business long if the credit card message is not delivered, and all our orders are fulfilled without payment!</span></span> <span data-ttu-id="8edf8-152">Du kan undvika dessa typer av problem genom att gruppera de två meddelandena i en transaktion.</span><span class="sxs-lookup"><span data-stu-id="8edf8-152">You can avoid these kinds of problems by grouping the two messages into a transaction.</span></span> <span data-ttu-id="8edf8-153">Meddelandetransaktioner lyckas eller misslyckas som en enda enhet – precis som i databasvärlden.</span><span class="sxs-lookup"><span data-stu-id="8edf8-153">Message transactions succeed or fail as a single unit - just like in the database world.</span></span> <span data-ttu-id="8edf8-154">Om leveransen av kreditkortsinformationen misslyckas kommer även orderinformationen att göra det.</span><span class="sxs-lookup"><span data-stu-id="8edf8-154">If the credit card details message delivery fails, then so will the order details message.</span></span>

## <a name="which-service-should-i-choose"></a><span data-ttu-id="8edf8-155">Vilken tjänst bör jag välja?</span><span class="sxs-lookup"><span data-stu-id="8edf8-155">Which service should I choose?</span></span>
<span data-ttu-id="8edf8-156">Eftersom du har förstått att kommunikationsstrategin för den här arkitekturen ska vara ett meddelande måste du välja om du ska använda Azure Storage-köer eller Azure Service Bus. Båda kan användas för att lagra och leverera meddelanden mellan dina komponenter.</span><span class="sxs-lookup"><span data-stu-id="8edf8-156">Having understood that the communication strategy for this architecture should be a message, you must choose whether to use Azure Storage queues or Azure Service Bus, both of which can be used to store and deliver messages between your components.</span></span> <span data-ttu-id="8edf8-157">De har något annorlunda funktionsuppsättningar, vilket innebär att du kan använda den ena, den andra eller båda två beroende på det problem som du vill lösa.</span><span class="sxs-lookup"><span data-stu-id="8edf8-157">Each has a slightly different feature set, which means you can choose one or the other, or use both, depending on the problem you are solving.</span></span>

#### <a name="choose-service-bus-topics-if"></a><span data-ttu-id="8edf8-158">Välj Service Bus-ämnen om</span><span class="sxs-lookup"><span data-stu-id="8edf8-158">Choose Service Bus Topics if</span></span>

- <span data-ttu-id="8edf8-159">du behöver flera mottagare för att hantera varje meddelande</span><span class="sxs-lookup"><span data-stu-id="8edf8-159">you need multiple receivers to handle each message</span></span>


#### <a name="choose-service-bus-queues-if"></a><span data-ttu-id="8edf8-160">Välj Service Bus-köer om följande stämmer in:</span><span class="sxs-lookup"><span data-stu-id="8edf8-160">Choose Service Bus queues if:</span></span>

- <span data-ttu-id="8edf8-161">Du behöver en garanti om leverans högst en gång.</span><span class="sxs-lookup"><span data-stu-id="8edf8-161">You need an At-Most-Once delivery guarantee.</span></span>
- <span data-ttu-id="8edf8-162">Du behöver en FIFO-garanti.</span><span class="sxs-lookup"><span data-stu-id="8edf8-162">You need a FIFO guarantee.</span></span>
- <span data-ttu-id="8edf8-163">Du behöver gruppera meddelanden i transaktioner.</span><span class="sxs-lookup"><span data-stu-id="8edf8-163">You need to group messages into transactions.</span></span>
- <span data-ttu-id="8edf8-164">Du vill ta emot meddelanden utan att avsöka kön.</span><span class="sxs-lookup"><span data-stu-id="8edf8-164">You want to receive messages without polling the queue.</span></span>
- <span data-ttu-id="8edf8-165">Du behöver ange en modell för rollbaserad åtkomst till köerna.</span><span class="sxs-lookup"><span data-stu-id="8edf8-165">You need to provide a role-based access model to the queues.</span></span>
- <span data-ttu-id="8edf8-166">Du behöver hantera meddelanden som är större än 64 KB men mindre än 256 KB.</span><span class="sxs-lookup"><span data-stu-id="8edf8-166">You need to handle messages larger than 64 KB but less than 256 KB.</span></span>
- <span data-ttu-id="8edf8-167">Storleken på din kö inte kommer att bli större än 80 GB.</span><span class="sxs-lookup"><span data-stu-id="8edf8-167">Your queue size will not grow larger than 80 GB.</span></span>
- <span data-ttu-id="8edf8-168">Du vill kunna publicera och använda batchar av meddelanden.</span><span class="sxs-lookup"><span data-stu-id="8edf8-168">You would like to be able to publish and consume batches of messages.</span></span>

<span data-ttu-id="8edf8-169">Kölagring har inte riktigt lika många funktioner, men om du inte behöver några av de funktionerna kan det vara ett enklare val.</span><span class="sxs-lookup"><span data-stu-id="8edf8-169">Queue storage isn't quite as feature-rich, but if you don't need any of those features, it can be a simpler choice.</span></span> <span data-ttu-id="8edf8-170">Dessutom är det den bästa lösningen om din app har något av följande krav.</span><span class="sxs-lookup"><span data-stu-id="8edf8-170">In addition, it's the best solution if your app has any of the following requirements.</span></span>

#### <a name="choose-queue-storage-if"></a><span data-ttu-id="8edf8-171">Välj Queue-lagring om:</span><span class="sxs-lookup"><span data-stu-id="8edf8-171">Choose Queue storage if:</span></span>

- <span data-ttu-id="8edf8-172">Du behöver en spårningslogg för alla meddelanden som skickas via kön.</span><span class="sxs-lookup"><span data-stu-id="8edf8-172">You need an audit trail of all messages that pass through the queue.</span></span>
- <span data-ttu-id="8edf8-173">Du förväntar dig att kön kommer att överskrida 80 GB i storlek.</span><span class="sxs-lookup"><span data-stu-id="8edf8-173">You expect the queue to exceed 80 GB in size.</span></span>
- <span data-ttu-id="8edf8-174">Du vill följa förloppet för bearbetning av ett meddelande i kön.</span><span class="sxs-lookup"><span data-stu-id="8edf8-174">You want to track progress for processing a message inside of the queue.</span></span>

<span data-ttu-id="8edf8-175">En kö är en enkel, tillfällig lagringsplats för meddelanden som skickas mellan komponenterna i ett distribuerat program.</span><span class="sxs-lookup"><span data-stu-id="8edf8-175">A queue is a simple, temporary storage location for messages sent between the components of a distributed application.</span></span> <span data-ttu-id="8edf8-176">Använd en kö till att ordna meddelanden och smidigt hantera oväntade toppar i efterfrågan.</span><span class="sxs-lookup"><span data-stu-id="8edf8-176">Use a queue to organize messages and gracefully handle unpredictable surges in demand.</span></span> 

<span data-ttu-id="8edf8-177">Använd Storage-köer om du vill ha ett enkelt kösystem som är lätt att koda.</span><span class="sxs-lookup"><span data-stu-id="8edf8-177">Use Storage queues when you want a simple and easy-to-code queue system.</span></span> <span data-ttu-id="8edf8-178">Använd Service Bus-köer för mer avancerade behov.</span><span class="sxs-lookup"><span data-stu-id="8edf8-178">For more advanced needs, use Service Bus queues.</span></span> <span data-ttu-id="8edf8-179">Om du har flera mål för ett enskilt meddelande, men behöver köliknande beteende, kan du använda ämnen.</span><span class="sxs-lookup"><span data-stu-id="8edf8-179">If you have multiple destinations for a single message, but need queue-like behavior, use topics.</span></span>