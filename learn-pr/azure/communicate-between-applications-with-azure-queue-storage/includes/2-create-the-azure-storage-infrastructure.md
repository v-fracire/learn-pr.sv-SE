<span data-ttu-id="ba6b2-101">Det kan vara problematiskt med direktkommunikation mellan komponenterna i ett distribuerat program eftersom kommunikationen kan avbrytas när nätverksbandbredden är låg eller när efterfrågan är hög.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-101">Direct communication between the components of a distributed application can be problematic because it might be disrupted when network bandwidth is low or when demand is high.</span></span>

<span data-ttu-id="ba6b2-102">Vi har sett det här i vårt system: webbportalen anropar en webbtjänst, och det fungerar bra om tjänsten svarar inom rimlig tid.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-102">We've seen this in our system: the web portal calls a web service, which works great if the service responds in a timely manner.</span></span> <span data-ttu-id="ba6b2-103">Stora trafikvolymer leder till problem, så planen att använda en kö för att eliminera direktlänken mellan apparna på klientsidan och din webbtjänst på mellannivå.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-103">High traffic causes problems and so the plan is to use a queue to eliminate the direct link between the front-end apps and your middle-tier web service.</span></span>

## <a name="what-is-azure-queue-storage"></a><span data-ttu-id="ba6b2-104">Vad är Azure Queue Storage?</span><span class="sxs-lookup"><span data-stu-id="ba6b2-104">What is Azure Queue storage?</span></span>

<span data-ttu-id="ba6b2-105">Azure Queue Storage är en Azure-tjänst som implementerar molnbaserade köer.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-105">Azure Queue storage is an Azure service that implements cloud-based queues.</span></span> <span data-ttu-id="ba6b2-106">Varje kö har en lista med meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-106">Each queue maintains a list of messages.</span></span> <span data-ttu-id="ba6b2-107">Programkomponenter kommer åt en kö med hjälp av ett REST-API eller ett Azure-tillhandahållet klientbibliotek.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-107">Application components access a queue using a REST API or an Azure-supplied client library.</span></span> <span data-ttu-id="ba6b2-108">Du kommer normalt har en eller flera _avsändarkomponenter_ och en eller flera _mottagarkomponenter_.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-108">Typically, you will have one or more _sender_ components and one or more _receiver_ components.</span></span> <span data-ttu-id="ba6b2-109">Avsändarkomponenterna lägger till meddelande i kön.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-109">Sender components add message to the queue.</span></span> <span data-ttu-id="ba6b2-110">Mottagarkomponenter hämtar meddelanden som ligger först i kön för bearbetning.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-110">Receiver components retrieve messages from the front of the queue for processing.</span></span> <span data-ttu-id="ba6b2-111">Följande bild visar flera avsändarappar som lägger till meddelanden i Azure-kön och en mottagarapp som hämtar meddelandena.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-111">The following illustration shows multiple sender applications adding messages to the Azure Queue and one receiver application retrieving the messages.</span></span>

![En bild som visar den övergripande arkitekturen i Azure Queue Storage](../media/2-queue-overview.png)

<span data-ttu-id="ba6b2-113">Prissättningen baseras på köstorleken och antalet åtgärder.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-113">Pricing is based on queue size and number of operations.</span></span> <span data-ttu-id="ba6b2-114">Större meddelandeköer kostar mer än mindre köer.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-114">Larger message queues cost more than smaller queues.</span></span> <span data-ttu-id="ba6b2-115">Debitering sker även för varje åtgärd, till exempel för att lägga till eller ta bort ett meddelande.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-115">Charges are also incurred for each operation, such as adding a message and deleting a message.</span></span> <span data-ttu-id="ba6b2-116">Information om priser finns i [Prissättning för Azure Queue Storage](https://azure.microsoft.com/pricing/details/storage/queues/).</span><span class="sxs-lookup"><span data-stu-id="ba6b2-116">For pricing details, see [Azure Queue storage pricing](https://azure.microsoft.com/pricing/details/storage/queues/).</span></span>

## <a name="why-use-queues"></a><span data-ttu-id="ba6b2-117">Varför bör jag använda köer?</span><span class="sxs-lookup"><span data-stu-id="ba6b2-117">Why use queues?</span></span>

<span data-ttu-id="ba6b2-118">Köer ökar robustheten genom att tillfälligt lagra väntande meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-118">A queue increases resiliency by temporarily storing waiting messages.</span></span> <span data-ttu-id="ba6b2-119">När efterfrågan är låg eller normal förblir storleken på kön liten eftersom målkomponenten tar bort meddelanden från kön snabbare än de läggs till.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-119">At times of low or normal demand, the size of the queue remains small because the destination component removes messages from the queue faster than they are added.</span></span> <span data-ttu-id="ba6b2-120">När efterfrågan är hög kan köstorleken öka, men meddelandena går inte förlorade.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-120">At times of high demand, the queue may increase in size, but messages are not lost.</span></span> <span data-ttu-id="ba6b2-121">Målkomponenten kan beta av och tömma kön när efterfrågan blir normal igen.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-121">The destination component can catch up and empty the queue as demand returns to normal.</span></span>

<span data-ttu-id="ba6b2-122">En enskild kö kan ha en storlek på upp till **500 TB**, så den kan potentiellt lagra _miljontals_ meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-122">A single queue can be up to **500 TB** in size, so it can potentially store _millions_ of messages.</span></span> <span data-ttu-id="ba6b2-123">Måldataflödet för en enskild kö är 2 000 meddelanden per sekund, så den kan hantera stora volymer.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-123">The target throughput for a single queue is 2000 messages per second, allowing it to handle high-volume scenarios.</span></span>

<span data-ttu-id="ba6b2-124">Köer gör att ditt program kan skalas om automatiskt och omedelbart när efterfrågan ändras.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-124">Queues let your application scale automatically and immediately when demand changes.</span></span> <span data-ttu-id="ba6b2-125">Det gör att de är användbara för kritiska affärsdata som skulle vara skadliga att förlora.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-125">This makes them useful for critical business data that would be damaging to lose.</span></span> <span data-ttu-id="ba6b2-126">Azure har många andra tjänster som skalas om automatiskt.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-126">Azure offers many other services that scale automatically.</span></span> <span data-ttu-id="ba6b2-127">Funktionen **Autoskalning** är till exempel tillgänglig för Azure VM-skalningsuppsättningar, molntjänster, Azure App Service-planer och App Service-miljöer.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-127">For example, the **Autoscale** feature is available on Azure virtual machine scale sets, cloud services, Azure App Service plans, and App Service environments.</span></span> <span data-ttu-id="ba6b2-128">På så sätt kan du definiera regler som Azure använder till att identifiera perioder med hög efterfrågan och automatiskt lägga till kapacitet utan hjälp från en administratör.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-128">This lets you define rules that Azure uses to identify periods of high demand and automatically add capacity without involving an administrator.</span></span> <span data-ttu-id="ba6b2-129">Automatisk skalning svarar på efterfrågan snabbt men inte omedelbart.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-129">Autoscaling responds to demand quickly, but not instantaneously.</span></span> <span data-ttu-id="ba6b2-130">Däremot hanterar Azure Queue Storage hög efterfrågan omedelbart genom att lagra meddelanden tills bearbetningsresurser blir tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-130">By contrast, Azure Queue storage instantaneously handles high demand by storing messages until processing resources are available.</span></span>

## <a name="what-is-a-message"></a><span data-ttu-id="ba6b2-131">Vad är ett meddelande?</span><span class="sxs-lookup"><span data-stu-id="ba6b2-131">What is a message?</span></span>

<span data-ttu-id="ba6b2-132">Ett meddelande i en kö är en bytematris på upp till 64 KB.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-132">A message in a queue is a byte array of up to 64 KB.</span></span> <span data-ttu-id="ba6b2-133">Meddelandeinnehåll tolkas inte alls av Azure-komponenter.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-133">Message contents are not interpreted at all by any Azure component.</span></span>

<span data-ttu-id="ba6b2-134">Om du vill skapa ett strukturerat meddelande kan du formatera meddelandeinnehållet med hjälp av XML eller JSON.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-134">If you want to create a structured message, you could format the message content using XML or JSON.</span></span> <span data-ttu-id="ba6b2-135">Din kod ansvarar för att generera och tolka ditt anpassade format.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-135">Your code is responsible for generating and interpreting your custom format.</span></span> <span data-ttu-id="ba6b2-136">Du kan till exempel skapa ett anpassat JSON-meddelande som ser ut så här:</span><span class="sxs-lookup"><span data-stu-id="ba6b2-136">For example, you could make a custom JSON message that looks like the following:</span></span>

```json
{
    "Message": {
        "To": "news@contoso.com",
        "From": "writer@contoso.com",
        "Subject": "Support request",
        "Body": "Send me a photographer!"
    }
}
```

## <a name="creating-a-storage-account"></a><span data-ttu-id="ba6b2-137">Skapa ett lagringskonto</span><span class="sxs-lookup"><span data-stu-id="ba6b2-137">Creating a storage account</span></span>

<span data-ttu-id="ba6b2-138">En kö måste ingå i ett lagringskonto.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-138">A queue must be part of a storage account.</span></span> <span data-ttu-id="ba6b2-139">Du kan skapa ett lagringskonto med Azure CLI (eller PowerShell) eller i Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-139">You can create a storage account using the Azure CLI (or PowerShell), or Azure portal.</span></span> <span data-ttu-id="ba6b2-140">Det är enklast att jobba i portalen eftersom processen är guidad och du tillfrågas om all information.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-140">The portal is easiest because it's all guided and prompts you for each piece of information.</span></span> 

<span data-ttu-id="ba6b2-141">I följande bild ser du var kategorin Lagringskonton finns.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-141">The following screenshot shows the location of the Storage accounts category.</span></span>

![Skärmbild med bladet Alla tjänster och kategorin Lagringskonton markerad.](../media/2-create-storage-account-1.png)

<span data-ttu-id="ba6b2-143">Du har flera alternativ när du skapar kontot, men du kan använda standardinställningen för de flesta.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-143">There are several options you can supply when you create the account, most of which you can use the default selection.</span></span> <span data-ttu-id="ba6b2-144">Vi har gått igenom de här alternativen i en tidigare modul, men du kan hovra över tipset `(i)` för respektive alternativ om du vill få en påminnelse.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-144">We covered these options in a previous module, but you can hover over the `(i)` tip associated with each option to get a reminder of what it does.</span></span> <span data-ttu-id="ba6b2-145">Här är ett exempel på hur du kan fylla i portalbladet.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-145">Here's an example of filling out the portal blade.</span></span>

<span data-ttu-id="ba6b2-146">I följande skärmbild ser du bladet Skapa lagringskonto och den information du behöver ange för att skapa ett lagringskonto.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-146">The following screenshot displays the Create storage account blade and the information required to create a storage account.</span></span>

![Skärmbild av bladet Skapa lagringskonto med alternativ som anges när du skapar ett lagringskonto.](../media/2-create-storage-account-2.png)

### <a name="settings-for-queues"></a><span data-ttu-id="ba6b2-148">Inställningar för köer</span><span class="sxs-lookup"><span data-stu-id="ba6b2-148">Settings for queues</span></span>
<span data-ttu-id="ba6b2-149">När du skapar ett lagringskonto som ska innehålla köer bör du överväga följande inställningar:</span><span class="sxs-lookup"><span data-stu-id="ba6b2-149">When you create a storage account that will contain queues, you should consider the following settings:</span></span>

- <span data-ttu-id="ba6b2-150">Köer är bara tillgängliga som en del av Azure-lagringskonton för generell användning (v1 eller v2).</span><span class="sxs-lookup"><span data-stu-id="ba6b2-150">Queues are only available as part of Azure general-purpose storage accounts (v1 or v2).</span></span> <span data-ttu-id="ba6b2-151">Du kan inte lägga till dem för bloblagringskonton.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-151">You cannot add them to Blob storage accounts.</span></span>
- <span data-ttu-id="ba6b2-152">Inställningen **Åtkomstnivå** som visas för StoraveV2-konton gäller enbart bloblagring och påverkar inte köer.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-152">The **Access tier** setting which is shown for StorageV2 accounts applies only to Blob storage and does not affect queues.</span></span>
- <span data-ttu-id="ba6b2-153">Välj en plats som ligger nära antingen källkomponenterna eller målkomponenterna, men helst nära båda.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-153">You should choose a location that is close to either the source components or destination components or (preferably) both.</span></span>
- <span data-ttu-id="ba6b2-154">Data replikeras alltid till flera servrar för att skydda mot diskfel och andra maskinvaruproblem.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-154">Data is always replicated to multiple servers to guard against disk failures and other hardware problems.</span></span> <span data-ttu-id="ba6b2-155">Du kan välja replikeringsstrategi: **lokalt redundant lagring (LRS)** har en låg kostnad men är sårbar för katastrofer som påverkar ett helt datacenter, medan **geo-redundant lagring (GRS)** replikerar data till andra Azure-datacenter.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-155">You have a choice of replication strategies: **Locally Redundant Storage (LRS)** is low-cost but vulnerable to disasters that affect an entire data center while **Geo-Redundant Storage (GRS)** replicates data to other Azure data centers.</span></span> <span data-ttu-id="ba6b2-156">Välj den replikeringsstrategi som passar bäst för dina redundansbehov.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-156">Choose the replication strategy that meets your redundancy needs.</span></span>
- <span data-ttu-id="ba6b2-157">Prestandanivån avgör hur ditt meddelande lagras: **Standard** använder magnetiska hårddiskar medan **Premium** använder SSD-diskar.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-157">The performance tier determines how your message are stored: **Standard** uses magnetic drives while **Premium** uses solid-state drives.</span></span> <span data-ttu-id="ba6b2-158">Välj Standard om du förväntar dig att topparna i efterfrågan kommer att vara kortvariga.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-158">Choose Standard if you expect peaks in demand to be short.</span></span> <span data-ttu-id="ba6b2-159">Överväg Premium om kölängden ibland blir lång och om du behöver minimera åtkomsttiden för meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-159">Consider Premium if queue length sometimes becomes long and you need to minimize the time to access messages.</span></span>
- <span data-ttu-id="ba6b2-160">Kräv säker överföring om känslig information kan skickas via kön.</span><span class="sxs-lookup"><span data-stu-id="ba6b2-160">Require secure transfer if sensitive information may pass through the queue.</span></span> <span data-ttu-id="ba6b2-161">Den här inställningen ser till att alla anslutningar till kön krypteras med Secure Sockets Layer (SSL).</span><span class="sxs-lookup"><span data-stu-id="ba6b2-161">This setting ensures that all connections to the queue are encrypted using Secure Sockets Layer (SSL).</span></span>