<span data-ttu-id="3dcf1-101">Innan vi kan skapa en virtuell Linux-dator i Azure måste vi fundera på fjärråtkomst.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-101">Before we can create a Linux virtual machine in Azure, we will need to think about remote access.</span></span> <span data-ttu-id="3dcf1-102">Vi vill kunna logga in på Linux-webbservern så att vi kan konfigurera programvaran och utföra underhåll.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-102">We want to be able to sign in to our Linux web server to configure the software and perform maintenance.</span></span> <span data-ttu-id="3dcf1-103">Standardmetoden för administration av virtuella Linux-datorer i Azure är SSH.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-103">The default approach to administering Linux VMs hosted in Azure is SSH.</span></span>

<!-- Activate the sandbox -->
[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="what-is-ssh"></a><span data-ttu-id="3dcf1-104">Vad är SSH?</span><span class="sxs-lookup"><span data-stu-id="3dcf1-104">What is SSH?</span></span>

<span data-ttu-id="3dcf1-105">Secure Shell (SSH) är ett krypterat anslutningsprotokoll som möjliggör säkra inloggningar via oskyddade anslutningar.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-105">Secure Shell (SSH) is an encrypted connection protocol that allows secure sign-ins over unsecured connections.</span></span> <span data-ttu-id="3dcf1-106">Med SSH kan du ansluta till ett terminalgränssnitt från en fjärransluten plats med hjälp av en nätverksanslutning.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-106">SSH allows you to connect to a terminal shell from a remote location using a network connection.</span></span>

<span data-ttu-id="3dcf1-107">Det finns två metoder som vi kan använda för att autentisera en SSH-anslutning: **användarnamn och lösenord** eller ett **SSH-nyckelpar**.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-107">There are two approaches we can use to authenticate an SSH connection: **username and password**, or an **SSH key pair**.</span></span>

> [!TIP]
> <span data-ttu-id="3dcf1-108">Även om SSH ger en krypterad anslutning blir den virtuella datorn sårbar för råstyrkeattacker för lösenord om du använder lösenord med SSH-anslutningar.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-108">Although SSH provides an encrypted connection, using passwords with SSH connections leaves the VM vulnerable to brute-force attacks of passwords.</span></span> <span data-ttu-id="3dcf1-109">En säkrare och lämpligare metod för att ansluta till en virtuell Linux-dator med SSH är ett offentligt/privat nyckelpar, som även kallas SSH-nycklar.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-109">A more secure and preferred method of connecting to a Linux VM with SSH is a public-private key pair, also known as SSH keys.</span></span>

<span data-ttu-id="3dcf1-110">Med ett SSH-nyckelpar kan du logga in på Linux-baserade virtuella Azure-datorer utan lösenord.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-110">With an SSH key pair, you can sign in to Linux-based Azure virtual machines without a password.</span></span> <span data-ttu-id="3dcf1-111">Det här är en säkrare metod om du bara planerar att logga in på den virtuella datorn från några få datorer.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-111">This is a more secure approach if you only plan to sign in to the VM from a few computers.</span></span> <span data-ttu-id="3dcf1-112">Om du behöver kunna komma åt den virtuella Linux-datorn från ett antal olika platser kanske en kombination av användarnamn och lösenord är en bättre metod.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-112">If you need to be able to access the Linux VM from a variety of locations, a username and password combination might be a better approach.</span></span> <span data-ttu-id="3dcf1-113">Ett SSH-nyckelpar består av två delar: en offentlig nyckel och en privat nyckel.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-113">There are two parts to an SSH key pair: a public key and a private key.</span></span>

* <span data-ttu-id="3dcf1-114">Den offentliga nyckeln placeras på den virtuella Linux-datorn eller en annan tjänst som du vill använda med kryptering med offentliga nycklar.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-114">The public key is placed on your Linux VM or any other service that you wish to use with public-key cryptography.</span></span> <span data-ttu-id="3dcf1-115">Den kan delas med vem som helst.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-115">This can be shared with anyone.</span></span>

* <span data-ttu-id="3dcf1-116">Den **privata nyckeln** är det du anger för att verifiera din identitet för den virtuella Linux-datorn när du upprättar en SSH-anslutning.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-116">The **private key** is what you present to verify your identity to your Linux VM when you make an SSH connection.</span></span> <span data-ttu-id="3dcf1-117">Det här är konfidentiell information som du måste skydda precis som ett lösenord eller andra privata uppgifter.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-117">Consider this confidential information and protect this like you would a password or any other private data.</span></span>

<span data-ttu-id="3dcf1-118">Du kan använda samma enskilda offentliga/privata nyckelpar för att få åtkomst till flera virtuella Azure-datorer och tjänster.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-118">You can use the same single public-private key pair to access multiple Azure VMs and services.</span></span>

## <a name="create-the-ssh-key-pair"></a><span data-ttu-id="3dcf1-119">Skapa SSH-nyckelpar</span><span class="sxs-lookup"><span data-stu-id="3dcf1-119">Create the SSH key pair</span></span>

<span data-ttu-id="3dcf1-120">I Linux, Windows 10 och MacOS kan du använda det inbyggda kommandot `ssh-keygen` för att generera de offentliga och privata SSH-nyckelfilerna.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-120">On Linux, Windows 10, and MacOS, you can use the built-in `ssh-keygen` command to generate the SSH public and private key files.</span></span>

> [!TIP]
> <span data-ttu-id="3dcf1-121">Windows 10 innehåller en SSH-klient i **Fall Creators Update**.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-121">Windows 10 includes an SSH client with the **Fall Creators Update**.</span></span> <span data-ttu-id="3dcf1-122">För tidigare versioner av Windows krävs ytterligare programvara om SSH ska användas. [Fullständig information finns i dokumentationen](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows).</span><span class="sxs-lookup"><span data-stu-id="3dcf1-122">Earlier versions of Windows require additional software to use SSH; [check the documentation for full details](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows).</span></span> <span data-ttu-id="3dcf1-123">Du kan också installera Linux-undersystemet för Windows och få samma funktionalitet.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-123">Alternatively, you can install the Linux subsystem for Windows and get the same functionality.</span></span>

> [!NOTE]
> <span data-ttu-id="3dcf1-124">Vi använder Azure Cloud Shell, där de genererade nycklarna lagras i Azure i ditt privata lagringskonto.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-124">We will use Azure Cloud Shell, which will store the generated keys in Azure in your private storage account.</span></span> <span data-ttu-id="3dcf1-125">Du kan också skriva dessa kommandon direkt i det lokala gränssnittet om du vill.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-125">You can also type these commands directly into your local shell if you prefer.</span></span> <span data-ttu-id="3dcf1-126">Du behöver anpassa instruktionerna i hela den här modulen utifrån en lokal session om du använder den här metoden.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-126">You will need to adjust the instructions throughout this module to reflect a local session if you take this approach.</span></span>

[!include[](../../../includes/azure-sandbox-activate.md)]

<span data-ttu-id="3dcf1-127">Här är minimikommandot som krävs för att generera nyckelparet för en virtuell Azure-dator.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-127">Here is the minimum command necessary to generate the key pair for an Azure VM.</span></span> <span data-ttu-id="3dcf1-128">Då skapas ett offentligt/privat SSH-2 (SSH-protokoll 2) RSA-nyckelpar med 2048 bitars längd (minimilängden).</span><span class="sxs-lookup"><span data-stu-id="3dcf1-128">This will create an SSH protocol 2 (SSH-2) RSA public-private key pair with a 2048-bit length (the minimum length).</span></span>

<span data-ttu-id="3dcf1-129">Ange det här kommandot i Cloud Shell:</span><span class="sxs-lookup"><span data-stu-id="3dcf1-129">Type this command into Cloud Shell:</span></span>

```bash
ssh-keygen -t rsa -b 2048
```

<span data-ttu-id="3dcf1-130">Verktyget efterfrågar filnamn och en valfri lösenfras.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-130">The tool will prompt for file names and an optional passphrase.</span></span> <span data-ttu-id="3dcf1-131">Välj standardvärdena.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-131">Just take the defaults.</span></span> <span data-ttu-id="3dcf1-132">Två filer skapas: `id_rsa` och `id_rsa.pub` i katalogen `~/.ssh`.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-132">It will create two files: `id_rsa` and `id_rsa.pub` in the `~/.ssh` directory.</span></span> <span data-ttu-id="3dcf1-133">Filerna skrivs över om de finns.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-133">The files will be overwritten if they exist.</span></span> <span data-ttu-id="3dcf1-134">Det finns olika alternativ som du kan använda för att ange filnamnet eller en lösenfras och undvika frågan.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-134">There are various options you can use to provide the file name or a passphrase to avoid the prompt.</span></span>

### <a name="private-key-passphrase"></a><span data-ttu-id="3dcf1-135">Lösenfras för privat nyckel</span><span class="sxs-lookup"><span data-stu-id="3dcf1-135">Private key passphrase</span></span>

<span data-ttu-id="3dcf1-136">Du kan också ange en lösenfras när du genererar din privata nyckel.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-136">You can optionally provide a passphrase while generating your private key.</span></span> <span data-ttu-id="3dcf1-137">Det är ett lösenord som du måste ange när du använder nyckeln.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-137">This is a password you must enter when you use the key.</span></span> <span data-ttu-id="3dcf1-138">Den här lösenfrasen används för att få åtkomst till den privata SSH-nyckelfilen och är inte lösenordet för användarkontot.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-138">This passphrase is used to access the private SSH key file and is not the user account password.</span></span>

<span data-ttu-id="3dcf1-139">När du lägger till en lösenfras för SSH-nyckeln krypteras den privata nyckeln med 128-bitars AES, så att den inte kan användas utan lösenfrasen som krävs för att dekryptera den.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-139">When you add a passphrase to your SSH key, it encrypts the private key using 128-bit AES so that the private key is useless without the passphrase to decrypt it.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3dcf1-140">Vi rekommenderar **starkt** att du skapar en lösenfras.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-140">It is **strongly** recommended that you add a passphrase.</span></span> <span data-ttu-id="3dcf1-141">Om en angripare stjäl din privata nyckel och om nyckeln inte skyddas med en lösenfras kan angriparen använda den privata nyckeln för att logga in på alla servrar som den offentliga nyckeln används för.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-141">If an attacker stole your private key and that key did not have a passphrase, they would be able to use that private key to log in to any servers that have the corresponding public key.</span></span> <span data-ttu-id="3dcf1-142">Om en lösenfras skyddar en privat nyckel kan den inte användas av den angriparen.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-142">If a passphrase protects a private key, it cannot be used by that attacker.</span></span> <span data-ttu-id="3dcf1-143">Detta ger ett extra säkerhetslager för infrastrukturen i Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-143">This provides an additional layer of security for your infrastructure on Azure.</span></span>

<span data-ttu-id="3dcf1-144">Här är ett exempel som visar hur du anger lösenfrasen.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-144">Here is an example showing how to set the passphrase.</span></span> <span data-ttu-id="3dcf1-145">Du behöver inte köra det här kommandot (men du kan göra det om du vill):</span><span class="sxs-lookup"><span data-stu-id="3dcf1-145">You don't need to execute this command (although you can if you want to):</span></span>

```bash
ssh-keygen -t rsa -b 4096 \
    -C "azureuser@myserver" \
    -f ~/.ssh/mykeys/myprivatekey \
    -N someReallySecurePhraseYouWillRemember
```

| <span data-ttu-id="3dcf1-146">Parameter</span><span class="sxs-lookup"><span data-stu-id="3dcf1-146">Parameter</span></span> | <span data-ttu-id="3dcf1-147">Vad läget gör</span><span class="sxs-lookup"><span data-stu-id="3dcf1-147">What it does</span></span> |
|-----------|--------------|
| `-t` | <span data-ttu-id="3dcf1-148">Typ av nyckel som ska skapas.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-148">Type of key to create.</span></span> <span data-ttu-id="3dcf1-149">Måste vara **rsa**.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-149">Must be **rsa**.</span></span> |
| `-b` | <span data-ttu-id="3dcf1-150">Antal bitar i nyckeln.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-150">Number of bits in the key.</span></span> <span data-ttu-id="3dcf1-151">Minsta längd är 2 048, högsta är 4 096.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-151">Minimum length is 2048; maximum is 4096.</span></span> |
| `-C` | <span data-ttu-id="3dcf1-152">En valfri kommentar som läggs till för den offentliga nyckeln och kan användas för att identifiera den.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-152">An optional comment to append to the public key that can be used to identify it.</span></span> <span data-ttu-id="3dcf1-153">Normalt är det här en e-postadress, men det är enkel text.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-153">Normally, this is an email address, but it's simple text.</span></span> <span data-ttu-id="3dcf1-154">Därför kan du använda den identifieringsmetod som du föredrar.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-154">As a result, you can use whatever identification method you prefer.</span></span> |
| `-f` | <span data-ttu-id="3dcf1-155">Plats och filnamn för den privata nyckelfilen.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-155">The location and file name of the private key file.</span></span> <span data-ttu-id="3dcf1-156">En motsvarande offentlig nyckelfil med tillägget **.pub** genereras i samma katalog.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-156">A corresponding public key file appended with **.pub** is generated in the same directory.</span></span> <span data-ttu-id="3dcf1-157">Katalogen måste finnas.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-157">The directory must exist.</span></span> |
| `-N` | <span data-ttu-id="3dcf1-158">Lösenfrasen som används för att kryptera den privata nyckeln.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-158">The passphrase used to encrypt the private key.</span></span> |

## <a name="use-the-ssh-key-pair-with-an-azure-linux-vm"></a><span data-ttu-id="3dcf1-159">Använda SSH-nyckelparet med en virtuell Linux-dator i Azure</span><span class="sxs-lookup"><span data-stu-id="3dcf1-159">Use the SSH key pair with an Azure Linux VM</span></span>

<span data-ttu-id="3dcf1-160">När du har genererat nyckelparet kan du använda det med en virtuell Linux-dator i Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-160">Once you have the key pair generated, you can use it with a Linux VM in Azure.</span></span> <span data-ttu-id="3dcf1-161">Du kan ange den offentliga nyckeln när den virtuella datorn skapas eller lägga till den efter att den virtuella datorn har skapats.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-161">You can supply the public key during the VM creation or add it after the VM has been created.</span></span>

<span data-ttu-id="3dcf1-162">Du kan visa filens innehåll i Azure Cloud Shell med följande kommando:</span><span class="sxs-lookup"><span data-stu-id="3dcf1-162">You can view the contents of the file in Azure Cloud Shell with the following command:</span></span>

```bash
cat ~/.ssh/id_rsa.pub
```

<span data-ttu-id="3dcf1-163">Det är en enda rad som ser ut ungefär så här:</span><span class="sxs-lookup"><span data-stu-id="3dcf1-163">It will be a single line and look something like:</span></span>

```output
ssh-rsa XXXXXXXXXXc2EAAAADAXABAAABAXC5Am7+fGZ+5zXBGgXS6GUvmsXCLGc7tX7/rViXk3+eShZzaXnt75gUmT1I2f75zFn2hlAIDGKWf4g12KWcZxy81TniUOTjUsVlwPymXUXxESL/UfJKfbdstBhTOdy5EG9rYWA0K43SJmwPhH28BpoLfXXXXXGX/ilsXXXXXKgRLiJ2W19MzXHp8z3Lxw7r9wx3HaVlP4XiFv9U4hGcp8RMI1MP1nNesFlOBpG4pV2bJRBTXNXeY4l6F8WZ3C4kuf8XxOo08mXaTpvZ3T1841altmNTZCcPkXuMrBjYSJbA8npoXAXNwiivyoe3X2KMXXXXXdXXXXXXXXXXCXXXXX/ azureuser@myserver
```

<span data-ttu-id="3dcf1-164">Kopiera det här värdet så att du kan använda det i nästa övning.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-164">Copy this value, so you can use it in the next exercise.</span></span>

### <a name="use-the-ssh-key-when-creating-a-linux-vm"></a><span data-ttu-id="3dcf1-165">Använda SSH-nyckeln när du skapar en virtuell Linux-dator</span><span class="sxs-lookup"><span data-stu-id="3dcf1-165">Use the SSH key when creating a Linux VM</span></span>

<span data-ttu-id="3dcf1-166">Om du vill tillämpa SSH-nyckeln när du skapar en ny virtuell Linux-dator behöver du kopiera innehållet i den offentliga nyckeln och ange det i Azure Portal, _eller_ ange den offentliga nyckelfilen i Azure CLI- eller Azure PowerShell-kommandot.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-166">To apply the SSH key while creating a new Linux VM, you will need to copy the contents of the public key and supply it to the Azure portal, _or_ supply the public key file to the Azure CLI or Azure PowerShell command.</span></span> <span data-ttu-id="3dcf1-167">Vi använder den här metoden när vi skapar vår virtuella Linux-dator.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-167">We'll use this approach when we create our Linux VM.</span></span>

### <a name="add-the-ssh-key-to-an-existing-linux-vm"></a><span data-ttu-id="3dcf1-168">Lägga till SSH-nyckeln på en befintlig virtuell Linux-dator</span><span class="sxs-lookup"><span data-stu-id="3dcf1-168">Add the SSH key to an existing Linux VM</span></span>

<span data-ttu-id="3dcf1-169">Om du redan har skapat en virtuell dator kan du installera den offentliga nyckeln på den virtuella Linux-datorn med kommandot `ssh-copy-id`.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-169">If you have already created a VM, you can install the public key onto your Linux VM with the `ssh-copy-id` command.</span></span> <span data-ttu-id="3dcf1-170">När nyckeln har auktoriserats för SSH beviljar den åtkomst till servern utan lösenord.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-170">Once the key has been authorized for SSH, it grants access to the server without a password.</span></span>

<span data-ttu-id="3dcf1-171">Skicka den offentliga nyckelfilen och användarnamnet som ska associeras med nyckeln:</span><span class="sxs-lookup"><span data-stu-id="3dcf1-171">Pass it the public key file and the username to associate with the key:</span></span>

```bash
ssh-copy-id -i ~/.ssh/id_rsa.pub azureuser@myserver
```

<span data-ttu-id="3dcf1-172">Nu när vi har vår offentliga nyckel går vi till Azure Portal och skapar en virtuell Linux-dator.</span><span class="sxs-lookup"><span data-stu-id="3dcf1-172">Now that we have our public key, let's switch to the Azure portal and create a Linux VM.</span></span>
