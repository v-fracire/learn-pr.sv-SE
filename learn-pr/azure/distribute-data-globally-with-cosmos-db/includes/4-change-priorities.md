<span data-ttu-id="e2cc6-101">När du har replikerat dina data i flera regioner kan du dra nytta av de lösningar för automatisk redundans som Azure Cosmos DB tillhandahåller.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-101">Once you've replicated your data in multiple regions, you can take advantage of the automated failover solutions Azure Cosmos DB provides.</span></span> <span data-ttu-id="e2cc6-102">Automatisk redundans är en funktion som är aktuell vid ett haveri eller andra händelser gör att en av dina läs- eller skrivregioner går offline. Det omdirigerar begäranden från den regionen som är offline till den näst mest prioriterade regionen.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-102">Automated failover is a feature that comes into play when there's a disaster or other event that takes one of your read or write regions offline, and it redirects requests from the offline region to the next most prioritized region.</span></span> 

<span data-ttu-id="e2cc6-103">För din webbaserade klädbutik, som du just replikerade till USA, östra, USA, västra och Storbritannien, västra kan du prioritera att om USA, östra går offline så kan du omdirigera läsningar till USA, västra i stället för Storbritannien, västra för att begränsa svarstiden.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-103">For your online clothing site, which you just replicated into East US, West US, and West UK, you can prioritize that if the East US goes offline, you can redirect reads to West US instead of West UK, to limit latency.</span></span> 

<span data-ttu-id="e2cc6-104">I den här enheten lär du dig om hur redundans fungerar och anger prioritet för de regioner där ditt företags data har replikerats.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-104">In this unit you'll learn about how failover works and set the priority for the regions in which your company's data has been replicated.</span></span>

## <a name="failover-basics"></a><span data-ttu-id="e2cc6-105">Grunderna för redundans</span><span class="sxs-lookup"><span data-stu-id="e2cc6-105">Failover basics</span></span>

<span data-ttu-id="e2cc6-106">I det sällsynta fall då det förekommer avbrott i en Azure-region eller ett datacenter utlöser Azure Cosmos DB automatiskt redundans för alla AZure Cosmos DB-konton med närvaro i den berörda regionen.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-106">In the rare event of an Azure regional outage or data center outage, Azure Cosmos DB automatically triggers failovers of all Azure Cosmos DB accounts with a presence in the affected region.</span></span>

<span data-ttu-id="e2cc6-107">**Vad händer om en läsregion har ett avbrott?**</span><span class="sxs-lookup"><span data-stu-id="e2cc6-107">**What happens if a read region has an outage?**</span></span>

<span data-ttu-id="e2cc6-108">Azure Cosmos DB-konton med en läsregion i någon av de berörda regionerna kopplas automatiskt bort från deras skrivregion och markeras som offline.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-108">Azure Cosmos DB accounts with a read region in one of the affected regions are automatically disconnected from their write region and marked offline.</span></span> <span data-ttu-id="e2cc6-109">Cosmos DB SDK implementerar ett protokoll för regional identifiering som gör att de automatiskt kan identifiera när en region är tillgänglig och omdirigera anrop till nästa tillgängliga region i listan över föredragna regioner.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-109">The Cosmos DB SDKs implement a regional discovery protocol that allows them to automatically detect when a region is available and redirect read calls to the next available region in the preferred region list.</span></span> <span data-ttu-id="e2cc6-110">Om ingen av regionerna i listan över föredragna regioner är tillgänglig kan återgår anrop automatiskt till den aktuella skrivregionen.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-110">If none of the regions in the preferred region list is available, calls automatically fall back to the current write region.</span></span> <span data-ttu-id="e2cc6-111">Det krävs inga ändringar i din programkod för att hantera regionala redundanser.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-111">No changes are required in your application code to handle regional failovers.</span></span> <span data-ttu-id="e2cc6-112">Under hela processen fortsätter konsekvensgarantier att tillämpas av Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-112">During this entire process, consistency guarantees continue to be honored by Azure Cosmos DB.</span></span>

<span data-ttu-id="e2cc6-113">När den berörda regionen återställs från avbrottet så återställs alla berörda Azure Cosmos DB-konton i regionen automatiskt av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-113">Once the affected region recovers from the outage, all the affected Azure Cosmos DB accounts in the region are automatically recovered by the service.</span></span> <span data-ttu-id="e2cc6-114">Azure Cosmos DB-konton som hade en läsregion i den berörda regionen synkroniseras sedan automatiskt med den aktuella skrivregionen och går online.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-114">Azure Cosmos DB accounts that had a read region in the affected region will then automatically sync with current write region and turn online.</span></span> <span data-ttu-id="e2cc6-115">Azure Cosmos DB SDK:er identifierar tillgängligheten för den nya regionen och utvärderar huruvida regionen ska väljas som aktuell läsregion baserat på listan över föredragna regioner som konfigurerats av programmet.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-115">The Azure Cosmos DB SDKs discover the availability of the new region and evaluate whether the region should be selected as the current read region based on the preferred region list configured by the application.</span></span> <span data-ttu-id="e2cc6-116">Efterföljande läsningar omdirigeras till den återställda regionen utan att det krävs några ändringar i din programkod.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-116">Subsequent reads are redirected to the recovered region without requiring any changes to your application code.</span></span>

<span data-ttu-id="e2cc6-117">**Vad händer om en skrivregion har ett avbrott?**</span><span class="sxs-lookup"><span data-stu-id="e2cc6-117">**What happens if a write region has an outage?**</span></span>

<span data-ttu-id="e2cc6-118">Om den berörda regionen är den aktuella skrivregionen och automatisk redundans är aktiverat för Azure Cosmos DB-kontot markeras regionen automatiskt som offline.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-118">If the affected region is the current write region and automatic failover is enabled for the Azure Cosmos DB account, then the region is automatically marked as offline.</span></span> <span data-ttu-id="e2cc6-119">Sedan höjs en alternativ region upp som skrivregionen för det berörda Azure Cosmos DB-kontot.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-119">Then, an alternative region is promoted as the write region for the affected Azure Cosmos DB account.</span></span>

<span data-ttu-id="e2cc6-120">Under automatisk redundans väljer Azure Cosmos DB automatiskt nästa skrivregion för ett visst Azure Cosmos DB-konto baserat på den angivna prioritetsordningen.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-120">During automatic failovers, Azure Cosmos DB automatically chooses the next write region for a given Azure Cosmos DB account based on the specified priority order.</span></span> <span data-ttu-id="e2cc6-121">Program kan använda egenskapen WriteEndpoint för klassen DocumentClient för att identifiera ändringen i skrivregionen.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-121">Applications can use the WriteEndpoint property of DocumentClient class to detect the change in write region.</span></span>

<span data-ttu-id="e2cc6-122">När den berörda regionen återställs från avbrottet så återställs alla berörda Cosmos DB-konton i regionen automatiskt av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-122">Once the affected region recovers from the outage, all the affected Cosmos DB accounts in the region are automatically recovered by the service.</span></span>

<span data-ttu-id="e2cc6-123">Nu ändrar vi läsregionen för din databas.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-123">Now let's modify the read region for your database.</span></span>

## <a name="set-read-region-priorities"></a><span data-ttu-id="e2cc6-124">Ange prioriteringar för läsregion</span><span class="sxs-lookup"><span data-stu-id="e2cc6-124">Set read region priorities</span></span>

1. <span data-ttu-id="e2cc6-125">I Azure-portalen går du till skärmen **Replikera data globalt** och klickar på **Automatisk redundans**.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-125">In the Azure portal, on the **Replicate data globally** screen, click **Automatic Failover**.</span></span> <span data-ttu-id="e2cc6-126">Automatisk redundans är endast aktiverat om databasen redan har replikerats till flera regioner.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-126">Automatic failover is only enabled if the database has already been replicated to more than one region.</span></span>
2. <span data-ttu-id="e2cc6-127">På skärmen **Automatisk redundans** växlar du **Aktivera automatisk redundans** till **PÅ**.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-127">On the **Automatic Failover** screen, change **Enable Automatic Failover** to **ON**.</span></span>
3. <span data-ttu-id="e2cc6-128">I avsnittet **Läsregioner** klickar du på den vänstra delen av raden **USA, östra** och drar sedan och släpper på den översta platsen.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-128">In the **Read regions** section, click the left portion of the **East US** row, and then drag and drop at the top position.</span></span>
4. <span data-ttu-id="e2cc6-129">Klicka på den vänstra delen av raden **Japan, östra** och dra och släpp till den andra positionen.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-129">Click the left portion of the **Japan East** row, and then drag and drop to the second position.</span></span>
5. <span data-ttu-id="e2cc6-130">Klicka på **OK**.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-130">Click **OK**.</span></span>

    ![Ändra läsregioner i portalen](../media/4-change-priorities/change-read-priorities.gif)

## <a name="summary"></a><span data-ttu-id="e2cc6-132">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="e2cc6-132">Summary</span></span>

<span data-ttu-id="e2cc6-133">I den här enheten har du lärt dig vad automatisk redundans gör, hur du kan använda det för att skydda mot oförutsedda avbrott och hur du ändrar prioriteringarna för läsregion.</span><span class="sxs-lookup"><span data-stu-id="e2cc6-133">In this unit, you've learned what automatic failover provides, how you can use it to protect against unforeseen outages, and how to modify read region priorities.</span></span>