<span data-ttu-id="78083-101">Med Azure Cosmos DB kan utvecklare välja mellan fem väldefinierade konsekvensmodeller längs konsekvensspektrumet: stark, begränsad föråldring, session, konsekvent prefix och slutlig.</span><span class="sxs-lookup"><span data-stu-id="78083-101">Azure Cosmos DB allows developers to choose between five well-defined consistency models along the consistency spectrum – strong, bounded staleness, session, consistent prefix, and eventual.</span></span> <span data-ttu-id="78083-102">Dessa konsekvensnivåer gör att du kan maximera tillgänglighet och prestanda för din databas, beroende på dina behov.</span><span class="sxs-lookup"><span data-stu-id="78083-102">These consistency levels enable you to maximize the availability and performance of your database, depending on your needs.</span></span> <span data-ttu-id="78083-103">I de fall då data måste bearbetas i en viss ordning kan stark konsekvens vara rätt val.</span><span class="sxs-lookup"><span data-stu-id="78083-103">For cases when data must be processed in a specific order, strong consistency might be the right choice.</span></span> <span data-ttu-id="78083-104">I de fall då data inte behöver vara omedelbart konsekventa kan slutlig konsekvens vara rätt val.</span><span class="sxs-lookup"><span data-stu-id="78083-104">Or for cases when data doesn't need to be immediately consistent, eventual consistency might be the right choice.</span></span> 

<span data-ttu-id="78083-105">I den här enheten bekantar du dig med de tillgängliga konsekvensnivåerna i Azure Cosmos DB och bestämmer rätt konsekvensnivå för din webbplats med kläder.</span><span class="sxs-lookup"><span data-stu-id="78083-105">In this unit, you'll familiarize yourself with the available consistency levels in Azure Cosmos DB and determine the correct consistency level for your online clothing site.</span></span>

## <a name="consistency-basics"></a><span data-ttu-id="78083-106">Grunderna om konsekvens</span><span class="sxs-lookup"><span data-stu-id="78083-106">Consistency basics</span></span>

<span data-ttu-id="78083-107">Varje databaskonto har en standardkonsekvensnivå som avgör konsekvensen för data i kontot.</span><span class="sxs-lookup"><span data-stu-id="78083-107">Each database account has a default consistency level, which determines the consistency of data within the account.</span></span> <span data-ttu-id="78083-108">I den ena änden av spektrumet finns stark konsekvens, som ger en linjärbarhetsgaranti där läsningarna garanterat returnerar den senaste versionen av ett objekt.</span><span class="sxs-lookup"><span data-stu-id="78083-108">At one end of the spectrum is Strong consistency, which offers a linearizability guarantee with the reads guaranteed to return the most recent version of an item.</span></span> <span data-ttu-id="78083-109">I den andra änden av spektrumet finns slutlig konsekvens, som garanterar att om det inte förekommer ytterligare skrivningar så konvergeras repliker i gruppen så småningom.</span><span class="sxs-lookup"><span data-stu-id="78083-109">At the other end of the spectrum is Eventual consistency, which guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> <span data-ttu-id="78083-110">I mitten finns sessionskonsekvens, som är den mest populära eftersom det garanterar monotoniska läsningar, monotona skrivningar och garantier om ”läs dina egna skrivningar” (RYW, Read Your Own Writes).</span><span class="sxs-lookup"><span data-stu-id="78083-110">In the middle is Session consistency, which is the most popular because it guarantees monotonic reads, monotonic writes, and read your own writes (RYW) guarantees.</span></span>

![The fem konsekvensnivåerna i Azure Cosmos DB](../media/5-change-consistency/five-consistency-levels.png)

<span data-ttu-id="78083-112">Garantier för varje konsekvensnivå visas i följande tabell.</span><span class="sxs-lookup"><span data-stu-id="78083-112">Guarantees about each consistency level are listed in the following table.</span></span>
 
<span data-ttu-id="78083-113">**Konsekvensnivåer och garantier**</span><span class="sxs-lookup"><span data-stu-id="78083-113">**Consistency levels and guarantees**</span></span>

| <span data-ttu-id="78083-114">Konsekvensnivå</span><span class="sxs-lookup"><span data-stu-id="78083-114">Consistency Level</span></span> | <span data-ttu-id="78083-115">Garantier</span><span class="sxs-lookup"><span data-stu-id="78083-115">Guarantees</span></span> |
| --- | --- |
| <span data-ttu-id="78083-116">Stark</span><span class="sxs-lookup"><span data-stu-id="78083-116">Strong</span></span> | <span data-ttu-id="78083-117">Linjärbarhet.</span><span class="sxs-lookup"><span data-stu-id="78083-117">Linearizability.</span></span> <span data-ttu-id="78083-118">Läsningar är garanterade att returnera den senaste versionen av ett objekt.</span><span class="sxs-lookup"><span data-stu-id="78083-118">Reads are guaranteed to return the most recent version of an item.</span></span>|
| <span data-ttu-id="78083-119">Begränsad föråldring</span><span class="sxs-lookup"><span data-stu-id="78083-119">Bounded Staleness</span></span> | <span data-ttu-id="78083-120">Konsekvent prefix.</span><span class="sxs-lookup"><span data-stu-id="78083-120">Consistent Prefix.</span></span> <span data-ttu-id="78083-121">Läsningar släpar efter skrivningar med som mest k-prefix eller t-intervall.</span><span class="sxs-lookup"><span data-stu-id="78083-121">Reads lag behind writes by at most k prefixes or t interval.</span></span> |
| <span data-ttu-id="78083-122">Session</span><span class="sxs-lookup"><span data-stu-id="78083-122">Session</span></span>   | <span data-ttu-id="78083-123">Konsekvent prefix.</span><span class="sxs-lookup"><span data-stu-id="78083-123">Consistent Prefix.</span></span> <span data-ttu-id="78083-124">Monotoniska läsningar, monotoniska skrivningar, läs-dina-skrivningar, skrivning-följer-läsning.</span><span class="sxs-lookup"><span data-stu-id="78083-124">Monotonic reads, monotonic writes, read-your-writes, write-follows-reads.</span></span> |
| <span data-ttu-id="78083-125">Konsekvent prefix</span><span class="sxs-lookup"><span data-stu-id="78083-125">Consistent Prefix</span></span> | <span data-ttu-id="78083-126">De uppdateringar som returneras är något prefix av alla uppdateringar, utan några mellanrum.</span><span class="sxs-lookup"><span data-stu-id="78083-126">Updates returned are some prefix of all the updates, with no gaps.</span></span> |
| <span data-ttu-id="78083-127">Slutlig</span><span class="sxs-lookup"><span data-stu-id="78083-127">Eventual</span></span>  | <span data-ttu-id="78083-128">Oordnade läsningar.</span><span class="sxs-lookup"><span data-stu-id="78083-128">Out of order reads.</span></span> |

<span data-ttu-id="78083-129">Du kan konfigurera standardkonsekvensnivån på ditt Azure Cosmos DB-konto (och senare åsidosätta konsekvens för en specifik läsbegäran) på Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="78083-129">You can configure the default consistency level on your Azure Cosmos DB account (and later override the consistency on a specific read request) in the Azure portal.</span></span> <span data-ttu-id="78083-130">Internt gäller standardkonsekvensnivån för data inom partitionsuppsättningarna, som kan sträcka sig över flera regioner.</span><span class="sxs-lookup"><span data-stu-id="78083-130">Internally, the default consistency level applies to data within the partition sets, which may span regions.</span></span>

<span data-ttu-id="78083-131">I Azure Cosmos DB är läsningar som ges vid session, konsekvent prefix och slutlig konsekvens dubbelt så billiga när det gäller förbrukning av enheter för programbegäran jämfört med läsningar med stark konsekvens eller konsekvens med begränsad föråldring.</span><span class="sxs-lookup"><span data-stu-id="78083-131">In Azure Cosmos DB, reads served at session, consistent prefix and eventual consistency are twice as cheap, in terms of request unit consumption, as reads with strong or bounded staleness consistency.</span></span>

### <a name="use-of-consistency-levels"></a><span data-ttu-id="78083-132">Användning av konsekvensnivåer</span><span class="sxs-lookup"><span data-stu-id="78083-132">Use of consistency levels</span></span>

<span data-ttu-id="78083-133">Cirka 73 % av Azure Cosmos DB-klientorganisationer använder sessionskonsekvens, och 20 % föredrar begränsad föråldring.</span><span class="sxs-lookup"><span data-stu-id="78083-133">About 73% of Azure Cosmos DB tenants use session consistency and 20% prefer bounded staleness.</span></span> <span data-ttu-id="78083-134">Cirka 3 % av Azure Cosmos DB-kunderna experimenterar med olika konsekvensnivåer inledningsvis innan de väljer en viss konsekvens för sitt program.</span><span class="sxs-lookup"><span data-stu-id="78083-134">Approximately 3% of Azure Cosmos DB customers experiment with various consistency levels initially before settling on a specific consistency choice for their application.</span></span> <span data-ttu-id="78083-135">Endast 2 %  av Azure Cosmos DB-klientorganisationer åsidosätter konsekvensnivåer per begäran.</span><span class="sxs-lookup"><span data-stu-id="78083-135">Only 2% of Azure Cosmos DB tenants override consistency levels on a per request basis.</span></span>

## <a name="consistency-levels-in-detail"></a><span data-ttu-id="78083-136">Ingående information om konsekvensnivåer</span><span class="sxs-lookup"><span data-stu-id="78083-136">Consistency levels in detail</span></span>

<span data-ttu-id="78083-137">Om du vill ha mer information om konsekvensnivåerna tittar du på de notskriftsbaserade konsekvensexempel som finns i Azure-portalen och granskar sedan informationen nedan om varje nivå.</span><span class="sxs-lookup"><span data-stu-id="78083-137">To learn more about the consistency levels, review the music-note based consistency examples provided in the Azure portal, then review the information below about each level.</span></span>

1. <span data-ttu-id="78083-138">I Azure-portalen klickar du på **Standardkonsekvens**.</span><span class="sxs-lookup"><span data-stu-id="78083-138">In the Azure portal, click **Default consistency**.</span></span>
2. <span data-ttu-id="78083-139">Klicka dig igenom var och en av de olika konsekvensmodellerna och titta på musikexemplen.</span><span class="sxs-lookup"><span data-stu-id="78083-139">Click through each of the different consistency models and watch the musical examples.</span></span> <span data-ttu-id="78083-140">Se hur data skrivs till olika regioner och hur valet av konsekvens påverkar hur notdata skrivs.</span><span class="sxs-lookup"><span data-stu-id="78083-140">See how data is written to the different regions and how the choice of consistency impacts how the note data is written.</span></span> <span data-ttu-id="78083-141">Observera att Strong (Stark) är nedtonat eftersom det bara är tillgängligt för data som skrivs till en enda region.</span><span class="sxs-lookup"><span data-stu-id="78083-141">Note that Strong is grayed out as it is only available for data written to a single region.</span></span>

    ![Lär dig mer om konsekvensinställningar i portalen](../media/5-change-consistency/consistency.gif)

<span data-ttu-id="78083-143">Nu tittar vi närmare på konsekvensnivåerna.</span><span class="sxs-lookup"><span data-stu-id="78083-143">Let's learn more about the consistency levels.</span></span> <span data-ttu-id="78083-144">Tänk på hur var och en av dessa konsekvensnivåer kan fungera för produkten och användardata för din webbaserade klädbutik.</span><span class="sxs-lookup"><span data-stu-id="78083-144">Think about how each of these consistency levels could work for your product and user data for your clothing retail site.</span></span>

### <a name="strong-consistency"></a><span data-ttu-id="78083-145">Stark konsekvens</span><span class="sxs-lookup"><span data-stu-id="78083-145">Strong consistency</span></span>

* <span data-ttu-id="78083-146">Stark konsekvens erbjuder en [linjärbarhetsgaranti](https://aphyr.com/posts/313-strong-consistency-models) där läsningarna garanterat returnerar den senaste versionen av ett objekt.</span><span class="sxs-lookup"><span data-stu-id="78083-146">Strong consistency offers a [linearizability](https://aphyr.com/posts/313-strong-consistency-models) guarantee with the reads guaranteed to return the most recent version of an item.</span></span>
* <span data-ttu-id="78083-147">Stark konsekvens garanterar att en skrivning endast är synlig när den genomförs varaktigt av majoritetskvorumet av repliker.</span><span class="sxs-lookup"><span data-stu-id="78083-147">Strong consistency guarantees that a write is only visible after it is committed durably by the majority quorum of replicas.</span></span> <span data-ttu-id="78083-148">En skrivning genomförs antingen synkront och varaktigt av både de primära och kvorumet av de sekundära, eller så avbryts den.</span><span class="sxs-lookup"><span data-stu-id="78083-148">A write is either synchronously committed durably by both the primary and the quorum of secondaries, or it is aborted.</span></span> <span data-ttu-id="78083-149">En läsning bekräftas alltid av majoritetskvorumet för läsning. En klient kan aldrig se en ogenomförd eller partiell skrivning, och läser garanterat alltid den senaste bekräftade skrivningen.</span><span class="sxs-lookup"><span data-stu-id="78083-149">A read is always acknowledged by the majority read quorum, a client can never see an uncommitted or partial write and is always guaranteed to read the latest acknowledged write.</span></span> 
* <span data-ttu-id="78083-150">Azure Cosmos DB-konton som är konfigurerade för att använda stark konsekvens kan inte associera mer än en Azure-region med ett Azure Cosmos DB-konto.</span><span class="sxs-lookup"><span data-stu-id="78083-150">Azure Cosmos DB accounts that are configured to use strong consistency cannot associate more than one Azure region with their Azure Cosmos DB account.</span></span>  
* <span data-ttu-id="78083-151">Kostnaden för en läsåtgärd (vad gäller förbrukade enheter för programbegäran) med stark konsekvens är högre än med sessionskonsekvens och slutlig konsekvens, men den är samma som för begränsad föråldring.</span><span class="sxs-lookup"><span data-stu-id="78083-151">The cost of a read operation (in terms of request units consumed) with strong consistency is higher than session and eventual, but the same as bounded staleness.</span></span>

### <a name="bounded-staleness-consistency"></a><span data-ttu-id="78083-152">Konsekvens med begränsad föråldring</span><span class="sxs-lookup"><span data-stu-id="78083-152">Bounded staleness consistency</span></span>

* <span data-ttu-id="78083-153">Konsekvens med begränsad föråldring garanterar att läsningarna kan släpa efter skrivningar med minst *K* versioner eller prefix för ett objekt eller ett tidsintervall på *t*.</span><span class="sxs-lookup"><span data-stu-id="78083-153">Bounded staleness consistency guarantees that the reads may lag behind writes by at most *K* versions or prefixes of an item or *t* time-interval.</span></span>
* <span data-ttu-id="78083-154">När begränsad föråldring väljs kan ”föråldringen” därför konfigureras på två sätt: det antal versioner *K* för objektet som läsningarna släpar efter skrivningarna, och tidsintervallet *t*.</span><span class="sxs-lookup"><span data-stu-id="78083-154">Therefore, when choosing bounded staleness, the "staleness" can be configured in two ways: number of versions *K* of the item by which the reads lag behind the writes, and the time interval *t*.</span></span>
* <span data-ttu-id="78083-155">Begränsad föråldring erbjuder total global ordning förutom i ”föråldringsfönstret”.</span><span class="sxs-lookup"><span data-stu-id="78083-155">Bounded staleness offers total global order except within the "staleness window."</span></span> <span data-ttu-id="78083-156">Garantierna för monoton läsning finns i en region både inuti och utanför ”föråldringsfönstret”.</span><span class="sxs-lookup"><span data-stu-id="78083-156">The monotonic read guarantees exist within a region both inside and outside the "staleness window."</span></span>
* <span data-ttu-id="78083-157">Begränsad föråldring ger en starkare konsekvensgaranti än session, konsekvent prefix eller slutlig konsekvens.</span><span class="sxs-lookup"><span data-stu-id="78083-157">Bounded staleness provides a stronger consistency guarantee than session, consistent-prefix, or eventual consistency.</span></span> <span data-ttu-id="78083-158">För globalt distribuerade program rekommenderar vi du använder begränsad föråldring för scenarier där du vill ha stark konsekvens men även vill ha 99,99 % tillgänglighet och korta svarstider.</span><span class="sxs-lookup"><span data-stu-id="78083-158">For globally distributed applications, we recommend you use bounded staleness for scenarios where you would like to have strong consistency but also want 99.99% availability and low latency.</span></span>
* <span data-ttu-id="78083-159">Azure Cosmos DB-konton som är konfigurerade med konsekvens med begränsad föråldring kan associera valfritt antal Azure-regioner till sitt Azure Cosmos DB-konto.</span><span class="sxs-lookup"><span data-stu-id="78083-159">Azure Cosmos DB accounts that are configured with bounded staleness consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="78083-160">Kostnaden för en läsåtgärd (vad gäller förbrukade enheter för programbegäran) med begränsad föråldring är högre än med sessionskonsekvens och slutlig konsekvens, men den är samma som för stark konsekvens.</span><span class="sxs-lookup"><span data-stu-id="78083-160">The cost of a read operation (in terms of RUs consumed) with bounded staleness is higher than session and eventual consistency, but the same as strong consistency.</span></span>

### <a name="session-consistency"></a><span data-ttu-id="78083-161">Sessionskonsekvens</span><span class="sxs-lookup"><span data-stu-id="78083-161">Session consistency</span></span>

* <span data-ttu-id="78083-162">Till skillnad för de modeller för global konsekvens som erbjuds av de starka konsekvensnivåerna och konsekvensnivåerna med begränsad föråldring har sessionskonsekvens omfång för en klientsession.</span><span class="sxs-lookup"><span data-stu-id="78083-162">Unlike the global consistency models offered by strong and bounded staleness consistency levels, session consistency is scoped to a client session.</span></span>
* <span data-ttu-id="78083-163">Sessionskonsekvens är utmärkt för alla scenarier där en enhets- eller en användarsession ingår eftersom det garanterar monotoniska läsningar, monotona skrivningar och garantier för ”läs dina egna skrivningar” (RYW).</span><span class="sxs-lookup"><span data-stu-id="78083-163">Session consistency is ideal for all scenarios where a device or user session is involved since it guarantees monotonic reads, monotonic writes, and read your own writes (RYW) guarantees.</span></span>
* <span data-ttu-id="78083-164">Sessionskonsekvens ger förutsägbar konsekvens för en session och maximalt läsningsdataflöde. Det erbjuder även skrivningar och läsningar med den kortaste svarstiden.</span><span class="sxs-lookup"><span data-stu-id="78083-164">Session consistency provides predictable consistency for a session, and maximum read throughput while offering the lowest latency writes and reads.</span></span>
* <span data-ttu-id="78083-165">Azure Cosmos DB-konton som är konfigurerade med sessionskonsekvens kan associera valfritt antal Azure-regioner till sitt Azure Cosmos DB-konto.</span><span class="sxs-lookup"><span data-stu-id="78083-165">Azure Cosmos DB accounts that are configured with session consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span>
* <span data-ttu-id="78083-166">Kostnaden för en läsåtgärd (vad gäller förbrukade enheter för programbegäran) med sessionskonsekvens är högre än med stark konsekvens och konsekvens med begränsad föråldring, men den är högre än med slutlig konsekvens.</span><span class="sxs-lookup"><span data-stu-id="78083-166">The cost of a read operation (in terms of RUs consumed) with session consistency level is less than strong and bounded staleness, but more than eventual consistency.</span></span>

### <a name="consistent-prefix-consistency"></a><span data-ttu-id="78083-167">Konsekvens med konsekvent prefix</span><span class="sxs-lookup"><span data-stu-id="78083-167">Consistent prefix consistency</span></span>

* <span data-ttu-id="78083-168">Konsekvent prefix garanterar att om det inte förekommer ytterligare skrivningar så konvergeras repliker i gruppen så småningom.</span><span class="sxs-lookup"><span data-stu-id="78083-168">Consistent prefix guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> 
* <span data-ttu-id="78083-169">Konsekvent prefix garanterar att läsningar aldrig ser skrivningar i oordning.</span><span class="sxs-lookup"><span data-stu-id="78083-169">Consistent prefix guarantees that reads never see out of order writes.</span></span> <span data-ttu-id="78083-170">Om skrivningar utfördes i ordningen `A, B, C` ser klienten antingen `A`, `A,B` eller `A,B,C`, men aldrig i oordning, till exempel `A,C` eller `B,A,C`.</span><span class="sxs-lookup"><span data-stu-id="78083-170">If writes were performed in the order `A, B, C`, then a client sees either `A`, `A,B`, or `A,B,C`, but never out of order like `A,C` or `B,A,C`.</span></span>
* <span data-ttu-id="78083-171">Azure Cosmos DB-konton som är konfigurerade med konsekvens med konsekvent prefix kan associera valfritt antal Azure-regioner till sitt Azure Cosmos DB-konto.</span><span class="sxs-lookup"><span data-stu-id="78083-171">Azure Cosmos DB accounts that are configured with consistent prefix consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 

### <a name="eventual-consistency"></a><span data-ttu-id="78083-172">Slutlig konsekvens</span><span class="sxs-lookup"><span data-stu-id="78083-172">Eventual consistency</span></span>

* <span data-ttu-id="78083-173">Slutlig konsekvens garanterar att om det inte förekommer ytterligare skrivningar så konvergeras repliker i gruppen så småningom.</span><span class="sxs-lookup"><span data-stu-id="78083-173">Eventual consistency guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span>
* <span data-ttu-id="78083-174">Slutlig konsekvens är den svagaste formen av konsekvens, där en klient kan hämta de värden som är äldre än dem som den hade sett förut.</span><span class="sxs-lookup"><span data-stu-id="78083-174">Eventual consistency is the weakest form of consistency where a client may get the values that are older than the ones it had seen before.</span></span>
* <span data-ttu-id="78083-175">Slutlig konsekvens ger den svagaste läsningskonsekvensen men erbjuder kortast svarstid för både läsningar och skrivningar.</span><span class="sxs-lookup"><span data-stu-id="78083-175">Eventual consistency provides the weakest read consistency but offers the lowest latency for both reads and writes.</span></span>
* <span data-ttu-id="78083-176">Azure Cosmos DB-konton som är konfigurerade med slutlig konsekvens kan associera valfritt antal Azure-regioner till sitt Azure Cosmos DB-konto.</span><span class="sxs-lookup"><span data-stu-id="78083-176">Azure Cosmos DB accounts that are configured with eventual consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="78083-177">Kostnaden för en läsåtgärd (vad gäller förbrukade enheter för programbegäran) med nivån slutlig konsekvens är den lägsta för alla Azure Cosmos DB-konsekvensnivåer.</span><span class="sxs-lookup"><span data-stu-id="78083-177">The cost of a read operation (in terms of RUs consumed) with the eventual consistency level is the lowest of all the Azure Cosmos DB consistency levels.</span></span>

## <a name="summary"></a><span data-ttu-id="78083-178">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="78083-178">Summary</span></span>

<span data-ttu-id="78083-179">I den här enheten har du lärt dig hur konsekvensnivåer kan användas för att maximera hög tillgänglighet och minimera svarstiden.</span><span class="sxs-lookup"><span data-stu-id="78083-179">In this unit, you've learned how consistency levels can be used to maximize high-availability and minimize latency.</span></span>