## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="e7670-101">Skapa nyckelvalv för dina program</span><span class="sxs-lookup"><span data-stu-id="e7670-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="e7670-102">Det är bra att ge skapa ett separat valv för varje distributionsmiljö för varje program, till exempel utveckling, testning och produktion.</span><span class="sxs-lookup"><span data-stu-id="e7670-102">Good practice is to create a separate vault for each deployment environment of each of your applications, such as development, test, and production.</span></span> <span data-ttu-id="e7670-103">Det är möjligt att använda valv för att dela hemligheter mellan flera appar, men risken för en angripare som får läsåtkomst till ett valv ökar med antalet hemligheter i valvet.</span><span class="sxs-lookup"><span data-stu-id="e7670-103">It's possible to use vaults to share secrets across multiple apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="e7670-104">Om du använder samma namn för hemligheter i olika miljöer för ett program, kommer den enda miljöspecifika konfiguration som behöver ändras i din app vara valvets URL.</span><span class="sxs-lookup"><span data-stu-id="e7670-104">If you use the same names for secrets across different environments for an application, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="e7670-105">Det krävs ingen inledande konfiguration för att skapa ett valv.</span><span class="sxs-lookup"><span data-stu-id="e7670-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="e7670-106">Din användaridentitet beviljas automatiskt en full uppsättning med behörigheter för hemlighetshantering och du kan börja lägga till hemligheter omedelbart.</span><span class="sxs-lookup"><span data-stu-id="e7670-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="e7670-107">När du har ett valv kan du lägga till och hantera hemligheter från alla Azure-administrationsgränssnitt, inklusive Azure-portalen, Azure CLI och Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e7670-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the Azure portal, the Azure CLI, and Azure PowerShell.</span></span> <span data-ttu-id="e7670-108">När du konfigurerar programmet till att använda valvet måste du tilldela korrekt behörighet, vilket vi tittar närmare på i nästa enhet.</span><span class="sxs-lookup"><span data-stu-id="e7670-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="e7670-109">Valvautentisering och behörigheter</span><span class="sxs-lookup"><span data-stu-id="e7670-109">Vault authentication and permissions</span></span>

<span data-ttu-id="e7670-110">API:n för Azure Key Vaults använder Azure Active Directory till att autentisera användare och program.</span><span class="sxs-lookup"><span data-stu-id="e7670-110">Azure Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="e7670-111">Principerna för valvåtkomst baseras på *åtgärder* och tillämpas i hela valvet.</span><span class="sxs-lookup"><span data-stu-id="e7670-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="e7670-112">Till exempel kan ett program med behörigheterna **Hämta** (läsa hemligheter), **Lista** (göra en lista med namnen på alla hemligheter) och **Ange** (skapa eller uppdatera hemligheter) för ett valv skapa hemligheter, visa en lista med alla namn på hemligheterna, samt hämta och ange alla hemligheter i det valvet.</span><span class="sxs-lookup"><span data-stu-id="e7670-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="e7670-113">*Alla* åtgärder som utförs i ett valv kräver autentisering och auktorisering &mdash; det finns inget sätt att bevilja någon form av anonym åtkomst.</span><span class="sxs-lookup"><span data-stu-id="e7670-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="e7670-114">När valvåtkomst beviljas för utvecklare och appar, beviljas endast den minsta uppsättningen behörigheter som krävs.</span><span class="sxs-lookup"><span data-stu-id="e7670-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="e7670-115">Tack vare behörighetsbegränsningarna kan man undvika incidenter på grund av kodbuggar och minska effekterna vid stulna autentiseringsuppgifter eller skadlig kod som sprids till din app.</span><span class="sxs-lookup"><span data-stu-id="e7670-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="e7670-116">Utvecklare kommer vanligtvis bara behöva behörigheterna **Hämta** och **Lista** i ett valvs utvecklingsmiljö.</span><span class="sxs-lookup"><span data-stu-id="e7670-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="e7670-117">En erfaren utvecklare behöver fullständig behörighet till valvet för att kunna ändra och lägga till hemligheter när det behövs.</span><span class="sxs-lookup"><span data-stu-id="e7670-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="e7670-118">Fullständig behörighet till produktionsmiljövalv är vanligtvis reserverade för erfaren personal.</span><span class="sxs-lookup"><span data-stu-id="e7670-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="e7670-119">För appar krävs vanligtvis endast behörigheten **Hämta**.</span><span class="sxs-lookup"><span data-stu-id="e7670-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="e7670-120">Vissa appar kan kräva **Lista**, beroende på hur appen implementeras.</span><span class="sxs-lookup"><span data-stu-id="e7670-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="e7670-121">Appen som vi implementerar i den här modulövningen kräver behörigheten **Lista**, på grund av den teknik som används för att läsa hemligheter från valvet.</span><span class="sxs-lookup"><span data-stu-id="e7670-121">The app we'll implement in this module's exercise requires the **List** permission because of the technique it uses to read secrets from the vault.</span></span>

<span data-ttu-id="e7670-122">På grund av alla problem som företaget har haft med programhemligheter, har ledningen bett dig att skapa en liten startapp som hjälper de andra utvecklarna.</span><span class="sxs-lookup"><span data-stu-id="e7670-122">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="e7670-123">Appen ska visa metodtips för att hantera hemligheter så enkelt och säkert som möjligt.</span><span class="sxs-lookup"><span data-stu-id="e7670-123">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

## <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="e7670-124">Skapa valvet och lagra hemligheten i det</span><span class="sxs-lookup"><span data-stu-id="e7670-124">Create the vault and store the secret in it</span></span>
<span data-ttu-id="e7670-125">Till att börja med måste du skapa ett valv och lagra en hemlighet.</span><span class="sxs-lookup"><span data-stu-id="e7670-125">To start, you'll create a vault and store one secret.</span></span>

###  <a name="create-the-vault"></a><span data-ttu-id="e7670-126">Skapa valvet</span><span class="sxs-lookup"><span data-stu-id="e7670-126">Create the vault</span></span>

<span data-ttu-id="e7670-127">Först skapar vi valvet och lagrar hemligheten i det.</span><span class="sxs-lookup"><span data-stu-id="e7670-127">First, we'll create the vault and store our secret in it.</span></span>

[!include[](../../../includes/azure-sandbox-activate.md)]

<span data-ttu-id="e7670-128">**Namn på nyckelvalv måste vara globalt unika, så du måste välja ett unikt namn**.</span><span class="sxs-lookup"><span data-stu-id="e7670-128">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="e7670-129">Valvnamn måste vara mellan 3 och 24 tecken långa och får endast innehålla alfanumeriska tecken och streck.</span><span class="sxs-lookup"><span data-stu-id="e7670-129">Vault names must be 3-24 characters long and contain only alphanumeric characters and dashes.</span></span> <span data-ttu-id="e7670-130">Skriv ned det valvnamn du väljer, eftersom du behöver det i den här övningen.</span><span class="sxs-lookup"><span data-stu-id="e7670-130">Make a note of the vault name you choose, as you'll need it throughout this exercise.</span></span>

[!include[](../../../includes/azure-sandbox-regions-first-mention-note.md)]

<span data-ttu-id="e7670-131">Kör följande kommando i Cloud Shell för att skapa valvet.</span><span class="sxs-lookup"><span data-stu-id="e7670-131">Run the following command in the Cloud Shell to create your vault.</span></span> <span data-ttu-id="e7670-132">Du kan ersätta värdet `--location` om du vill placera det någon annanstans från ovanstående val.</span><span class="sxs-lookup"><span data-stu-id="e7670-132">You can replace the `--location` value if you want to put it into a different location from the above selections.</span></span>

```azurecli
az keyvault create \
    --name <your-unique-vault-name> \
    --resource-group <rgn>[sandbox resource group name]</rgn> \
    --location eastus
```

<span data-ttu-id="e7670-133">När det är klart visas JSON-utdata med en beskrivning av det nya valvet.</span><span class="sxs-lookup"><span data-stu-id="e7670-133">When it finishes, you'll see JSON output describing the new vault.</span></span>

> [!TIP]
> <span data-ttu-id="e7670-134">Kommandot använde resursgruppen **<rgn>[Resursgruppsnamn för sandbox-miljö]</rgn>** som har skapats på förhand.</span><span class="sxs-lookup"><span data-stu-id="e7670-134">The command used the pre-created resource group named **<rgn>[sandbox Resource Group]</rgn>**.</span></span> <span data-ttu-id="e7670-135">När du arbetar med din egen prenumeration skulle antingen skapa en ny resursgrupp eller använda en befintlig som du har skapat tidigare.</span><span class="sxs-lookup"><span data-stu-id="e7670-135">When working with your own subscription, you would want to either create a new Resource Group, or use an existing one you have previously created.</span></span>

### <a name="add-the-secret"></a><span data-ttu-id="e7670-136">Lägga till en hemlighet</span><span class="sxs-lookup"><span data-stu-id="e7670-136">Add the secret</span></span>

<span data-ttu-id="e7670-137">Lägg nu till hemligheten: Vår hemlighet får namnet **SecretPassword** med värdet **reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="e7670-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set \
    --name SecretPassword \
    --value reindeer_flotilla \
    --vault-name <your-unique-vault-name>
```

<span data-ttu-id="e7670-138">Vi ska skriva koden för våra program strax, men först måste vi ta reda på lite mer om hur vår app ska autentiseras till ett valv.</span><span class="sxs-lookup"><span data-stu-id="e7670-138">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>