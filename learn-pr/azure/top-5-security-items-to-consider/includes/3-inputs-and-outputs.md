<span data-ttu-id="5ab3f-101">Den vanligaste säkerhetsbristen i program i dag är att inte korrekt bearbeta indata som tas emot från externa källor, särskilt _användarinmatning_.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-101">The most prevalent security weakness of applications today is to not correctly process input received from external sources, particularly _user input_.</span></span> <span data-ttu-id="5ab3f-102">Du bör alltid kontrollera indata noggrant för att se till att de verifieras innan de används.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-102">You should always take a close look at any input to make sure it has been validated before it is used.</span></span> <span data-ttu-id="5ab3f-103">Om du inte gör detta kan det leda till förlust eller exponering av data, eskalering av privilegier eller till och med körning av skadlig kod på andra användares datorer.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-103">Failing to do this can result in data loss or exposure, escalation of privilege, or even execution of malicious code on other users' computers.</span></span>

<span data-ttu-id="5ab3f-104">Det som är så onödigt med dessa problem att de enkelt kan lösas.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-104">The tragic thing is that this is an easy problem to solve.</span></span> <span data-ttu-id="5ab3f-105">Här går vi igenom hur du behandlar data: när de tas emot, när de visas på skärmen och när de är sparas för senare användning.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-105">Here we will cover how to treat data; when it’s received, when it’s displayed on the screen, and when it's stored for later use.</span></span>

## <a name="why-do-we-need-to-validate-our-input"></a><span data-ttu-id="5ab3f-106">Varför behöver vi verifiera våra indata?</span><span class="sxs-lookup"><span data-stu-id="5ab3f-106">Why do we need to validate our input?</span></span>

<span data-ttu-id="5ab3f-107">Anta att du skapar ett gränssnitt för att användare ska kunna skapa ett konto på din webbplats.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-107">Imagine that you are building an interface to allow a user to create an account on your website.</span></span> <span data-ttu-id="5ab3f-108">Våra profildata inkluderar ett namn, en e-postadress och ett smeknamn som vi visar för alla som besöker webbplatsen.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-108">Our profile data includes a name, email, and a nickname that we will display to everyone who visits the site.</span></span> <span data-ttu-id="5ab3f-109">Vad händer om en ny användare skapar en profil och anger ett smeknamn som innehåller vissa SQL-kommandon?</span><span class="sxs-lookup"><span data-stu-id="5ab3f-109">What if a new user creates a profile and enters a nickname that includes some SQL commands?</span></span> <span data-ttu-id="5ab3f-110">Vad händer om våra illasinnade användare anger något i still med följande:</span><span class="sxs-lookup"><span data-stu-id="5ab3f-110">For example - what if our bad user enters something like:</span></span>

```sql
Eve'); DROP TABLE Users;--
```

<span data-ttu-id="5ab3f-111">Om vi utan vidare infogar det här värdet i en databas kan det potentiellt ändra SQL-instruktionen till att köra kommandon som vi absolut inte vill!</span><span class="sxs-lookup"><span data-stu-id="5ab3f-111">If we just blindly insert this value into a database, it could potentially alter the SQL statement to execute commands we absolutely don't want to run!</span></span> <span data-ttu-id="5ab3f-112">Det här kallas en ”SQL-inmatningsattack” och är en av de _många_ typer av kryphål som potentiellt kan utföras när indata inte hanteras på rätt sätt.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-112">This is referred to as a "SQL Injection" attack and is one of the _many_ types of exploits that can potentially be done when you don't properly handle inputs.</span></span> <span data-ttu-id="5ab3f-113">Vad kan vi då göra för att åtgärda detta?</span><span class="sxs-lookup"><span data-stu-id="5ab3f-113">So, what can we do to fix this?</span></span> <span data-ttu-id="5ab3f-114">I den här enheten får du lära dig när indata ska valideras, hur utdata ska kodas samt hur du skapar parametriserade frågor (vilket löser kryphålet ovan!).</span><span class="sxs-lookup"><span data-stu-id="5ab3f-114">This unit will teach you when to validate input, how to encode output, and how to create parameterized queries (which solves the above exploit).</span></span> <span data-ttu-id="5ab3f-115">Det här är de tre huvudsakliga försvarsteknikerna mot skadliga indata som försöker inmatas i dina program.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-115">These are the three main defense techniques against malicious input being entered into your applications.</span></span>

## <a name="when-do-i-need-to-validate-input"></a><span data-ttu-id="5ab3f-116">När behöver jag verifiera indata?</span><span class="sxs-lookup"><span data-stu-id="5ab3f-116">When do I need to validate input?</span></span>

<span data-ttu-id="5ab3f-117">Svaret är _alltid_.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-117">The answer is _always_.</span></span> <span data-ttu-id="5ab3f-118">Du måste verifiera **alla** indata till ditt program.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-118">You must validate **every** input for your application.</span></span> <span data-ttu-id="5ab3f-119">Detta inkluderar parametrar i URL:en, indata från användare, data från databasen, data från ett API och allt som skickas i klartext som en användare potentiellt kan manipulera.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-119">This includes parameters in the URL, input from the user, data from the database, data from an API and anything that is passed in the clear that a user could potentially manipulate.</span></span> <span data-ttu-id="5ab3f-120">Använd alltid metoden med en vitlista, vilket innebär att du bara godkänner indata som är ”bekräftat goda” i stället för en svartlista (där du specifikt letar efter felaktiga indata) eftersom det är omöjligt att skapa en fullständig lista över potentiellt skadliga indata.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-120">Always use a whitelist approach, which means you only accept "known good" input, instead of a blacklist (where you specifically look for bad input) because it's impossible to think of a complete list of potentially dangerous input.</span></span>  <span data-ttu-id="5ab3f-121">Utför det här arbetet på serversidan, inte på klientsidan (eller utöver klientsidan) så att dina försvar inte kan kringgås.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-121">Do this work on the server, not the client-side (or in addition to the client-side), to ensure that your defenses cannot be circumvented.</span></span> <span data-ttu-id="5ab3f-122">Om du behandlar **ALLA** data som ej betrodda skyddar du mot de flesta vanliga säkerhetshoten för webbappar.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-122">Treat **ALL** data as untrusted and you will protect yourself from most of the common web app vulnerabilities.</span></span>

<span data-ttu-id="5ab3f-123">Om du använder ASP.NET ger ramverket [utmärkt stöd för att verifiera indata](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) på både klient- och servernsidan.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-123">If you are using ASP.NET, the framework provides [great support for validating input](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) on both the client and server side.</span></span>

<span data-ttu-id="5ab3f-124">Om du använder ett annat webbramverk finns det vissa bra metoder för att utföra verifiering av indata tillgängliga på [OWASP:s översiktsblad om verifiering av indata](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet).</span><span class="sxs-lookup"><span data-stu-id="5ab3f-124">If you are using another web framework, there are some great techniques for doing input validation available on the [OWASP Input Validation Cheatsheet](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet).</span></span>


## <a name="always-use-parameterized-queries"></a><span data-ttu-id="5ab3f-125">Använd alltid parametriserade frågor</span><span class="sxs-lookup"><span data-stu-id="5ab3f-125">Always use parameterized queries</span></span>

<span data-ttu-id="5ab3f-126">SQL-databaser används ofta för att lagra data, till exempel profilinformation.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-126">SQL databases are commonly used to store data, for example profile information.</span></span>  <span data-ttu-id="5ab3f-127">Skapa aldrig infogat SQL eller andra databasfrågor ”i farten” i din kod och skicka den direkt till databasen – som vi såg ovan kan resultatet bli katastrofalt.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-127">Never create inline SQL or other database queries "on the fly" in your code and send it directly to the database, this is a recipe for disaster, as we saw above.</span></span>

<span data-ttu-id="5ab3f-128">Till exempel ska du **inte göra detta** (kallas även infogat SQL):</span><span class="sxs-lookup"><span data-stu-id="5ab3f-128">For example, **do not do this** (known as inline SQL):</span></span>

```csharp
string userName = ... // receive input from the user BEWARE!
...
string query = "SELECT *  FROM  [dbo].[users] WHERE userName = '" + userName + "'";
```

<span data-ttu-id="5ab3f-129">Här sammanfogar vi textsträngar för att skapa frågan. Vi använder indata från användaren och genererar en dynamisk SQL-fråga för att leta upp användaren.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-129">Here we concatenate text strings together to create the query, taking the input from the user and generating a dynamic SQL query to lookup the user.</span></span> <span data-ttu-id="5ab3f-130">Om en illasinnad användare skulle inse att vi gör detta eller helt enkelt _prova_ olika indataformat för att se om det finns en sårbarhet kan det leda till en stor katastrof.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-130">Again, if a malicious user realized we were doing this, or just _tried_ different input styles to see if there was a vulnerability, we could end up with a major disaster.</span></span> <span data-ttu-id="5ab3f-131">Använd istället parametriserade SQL-instruktioner eller lagrade procedurer som den här:</span><span class="sxs-lookup"><span data-stu-id="5ab3f-131">Instead, use parameterized SQL statements or stored procedures such as this:</span></span>

```sql
-- Lookup a user
CREATE PROCEDURE sp_findUser
(
@UserName varchar(50)
)

SELECT *  FROM  [dbo].[users] WHERE userName = @UserName
```

<span data-ttu-id="5ab3f-132">Med den här metoden kan du anropa proceduren från din kod på ett säkert sätt och skicka strängen `userName` utan att behöva bekymra dig om den behandlas som en del av SQL-instruktionen.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-132">With this method you can invoke the procedure from your code safely, passing it the `userName` string without worrying about it being treated as part of the SQL statement.</span></span>

## <a name="always-encode-your-output"></a><span data-ttu-id="5ab3f-133">Koda alltid dina utdata</span><span class="sxs-lookup"><span data-stu-id="5ab3f-133">Always encode your output</span></span>

<span data-ttu-id="5ab3f-134">Alla utdata som du presenterar antingen visuellt eller inom ett dokument ska alltid kodas och undantas.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-134">Any output you present either visually or within a document should always be encoded and escaped.</span></span> <span data-ttu-id="5ab3f-135">Detta kan skydda dig om något förbises i saneringsomgången eller om koden av misstag genererar något som kan användas i skadligt syfte.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-135">This can protect you in case something was missed in the sanitization pass, or the code accidentally generates something that can be used maliciously.</span></span> <span data-ttu-id="5ab3f-136">På så sätt ser du till att allt visas som _utdata_ och inte oavsiktligt tolkas som något som ska köras.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-136">This will make sure that everything is displayed as _output_ and not inadvertently interpreted as something that should be executed.</span></span> <span data-ttu-id="5ab3f-137">Det här är en annan mycket vanlig angreppsmetod som kallas ”skriptkörning över flera webbplatser” (XSS, Cross-Site Scripting).</span><span class="sxs-lookup"><span data-stu-id="5ab3f-137">This is another very common attack technique referred to as "Cross-Site Scripting" (XSS).</span></span>

<span data-ttu-id="5ab3f-138">Eftersom det här är ett vanligt krav utgör det här ytterligare ett område där ASP.NET gör arbetet åt dig.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-138">Since this is such as common requirement, this is another area where ASP.NET will do the work for you.</span></span> <span data-ttu-id="5ab3f-139">Som standard är alla utdata redan kodade.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-139">By default, all output is already encoded.</span></span> <span data-ttu-id="5ab3f-140">Om du använder ett annat webbramverk kan du kontrollera dina alternativ för utdatakodning på webbplatser med [OWASP:s översiktsblad om XSS-skydd](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span><span class="sxs-lookup"><span data-stu-id="5ab3f-140">If you are using another web framework, you can verify your options for output encoding on websites with the [OWASP XSS Prevention Cheatsheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span></span>

## <a name="summary"></a><span data-ttu-id="5ab3f-141">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="5ab3f-141">Summary</span></span>

<span data-ttu-id="5ab3f-142">Att sanera och verifiera dina indata är ett nödvändigt krav för att se till att dina indata är giltiga och säkra att använda och lagra.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-142">Santizing and validating your input is a necessary requirement to ensure your input is valid and safe to use and store.</span></span> <span data-ttu-id="5ab3f-143">De flesta moderna webbramverk erbjuder inbyggda funktioner som kan automatisera en del av arbetet.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-143">Most modern web frameworks offer built-in features which can automate some of this work.</span></span> <span data-ttu-id="5ab3f-144">Du kan kontrollera din önskade framework-dokumentation och se vilka funktioner som erbjuds.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-144">You can check your preferred framework's documentation and see what features it offers.</span></span> <span data-ttu-id="5ab3f-145">Även om webbprogram är den vanligaste plats där det här inträffar så bör du tänka på att andra typer av program kan vara precis lika sårbara.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-145">While web applications are the most common place where this happens, keep in mind that other types of applications can be just as vulnerable.</span></span> <span data-ttu-id="5ab3f-146">Tro inte att du är säker för att ditt nya program är en skrivbordsapp.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-146">Don't think you're safe just because your new application is a desktop app.</span></span> <span data-ttu-id="5ab3f-147">Du behöver fortfarande kunna hantera indata från användare för att säkerställa att ingen använder din app för att skada dina data eller företagets rykte.</span><span class="sxs-lookup"><span data-stu-id="5ab3f-147">You will still need to properly handle user input to ensure someone doesn't use your app to corrupt your data, or damage your company's reputation.</span></span>