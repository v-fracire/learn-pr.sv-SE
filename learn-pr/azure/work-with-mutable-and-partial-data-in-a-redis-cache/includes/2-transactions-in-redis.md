<span data-ttu-id="8856b-101">Det finns tillfällen då du måste garantera att flera åtgärder körs tillsammans.</span><span class="sxs-lookup"><span data-stu-id="8856b-101">There are times when you must guarantee that multiple operations execute together.</span></span> <span data-ttu-id="8856b-102">I programmet för snabbmeddelanden kan användarna exempelvis skicka följande: en enskild bild, ett enskilt textmeddelande eller en bild och text tillsammans.</span><span class="sxs-lookup"><span data-stu-id="8856b-102">For example, in your instant messaging application, users can send an individual picture, an individual text message, or a picture and text message together.</span></span> <span data-ttu-id="8856b-103">När användaren väljer att skicka ett meddelande med bilder och text tillsammans måste du kontrollera att andra medlemmar i gruppen får dem på samma gång.</span><span class="sxs-lookup"><span data-stu-id="8856b-103">When the user chooses to send a picture and text message together, you must ensure that other members of the group receive them at the same time.</span></span> <span data-ttu-id="8856b-104">Detta är viktigt. Om ett bild- och textmeddelande inte tas emot tillsammans, är det nämligen möjligt att ett separat meddelande kan skickas mellan bilden och textmeddelandet.</span><span class="sxs-lookup"><span data-stu-id="8856b-104">This is important because if a picture and text message are not received together, it’s possible that a separate message could be sent in between the picture and text message.</span></span> <span data-ttu-id="8856b-105">Det kan göra den övergripande konversationen förvirrande.</span><span class="sxs-lookup"><span data-stu-id="8856b-105">That could make the overall conversation confusing.</span></span>

<span data-ttu-id="8856b-106">Här ska vi titta på hur du skapar en transaktion i Azure Redis Cache för att garantera att flera åtgärder körs tillsammans.</span><span class="sxs-lookup"><span data-stu-id="8856b-106">Here, we'll look at how to create a transaction in Azure Redis Cache to guarantee that multiple operations are executed together.</span></span>

## <a name="creating-and-running-transactions"></a><span data-ttu-id="8856b-107">Skapa och köra transaktioner</span><span class="sxs-lookup"><span data-stu-id="8856b-107">Creating and running transactions</span></span>

<span data-ttu-id="8856b-108">Transaktioner i Redis fungerar genom att sätta flera kommandon i kö så de körs som en grupp.</span><span class="sxs-lookup"><span data-stu-id="8856b-108">Transactions in Redis work by queueing multiple commands to be executed as a group.</span></span> <span data-ttu-id="8856b-109">När en transaktion körs, garanteras att de kommandon som är i kö inuti den körs utan andra kommandon från andra klienter överlagrade mellan dem.</span><span class="sxs-lookup"><span data-stu-id="8856b-109">When a transaction is executed, the commands queued inside of it are guaranteed to execute without any other commands from other clients interleaved between them.</span></span>

<span data-ttu-id="8856b-110">För att påbörja ett transaktionsblock, anger du kommandot `MULTI`.</span><span class="sxs-lookup"><span data-stu-id="8856b-110">To begin a transaction block, enter the `MULTI` command.</span></span> <span data-ttu-id="8856b-111">Ytterligare kommandon kommer i kö och utförs inte omedelbart.</span><span class="sxs-lookup"><span data-stu-id="8856b-111">Further commands will be queued and not executed immediately.</span></span> <span data-ttu-id="8856b-112">Om du kör kommandot `EXEC` så körs alla köade kommandon som en transaktionell enhet.</span><span class="sxs-lookup"><span data-stu-id="8856b-112">Running the `EXEC` command will execute all of the queued commands as a transactional unit.</span></span> <span data-ttu-id="8856b-113">Om du vill att avbryta en öppen transaktion när queuing kommandon körs den `DISCARD` stängs transaktion blocket utan att köra kommandot _alla_ av kommandona i kö.</span><span class="sxs-lookup"><span data-stu-id="8856b-113">If you decide you want to abort an open transaction while queuing commands, running the `DISCARD` command will close the transaction block without running _any_ of the queued commands.</span></span>

<span data-ttu-id="8856b-114">Redis-transaktioner stöder inte begreppet återställning.</span><span class="sxs-lookup"><span data-stu-id="8856b-114">Redis transactions do not support the concept of rollback.</span></span> <span data-ttu-id="8856b-115">Om du köar ett kommando med felaktig syntax i ett transaktionsblock så kommer blocket att fortsätta vara öppet, men kommer automatiskt att tas bort om du försöker köra det med `EXEC`.</span><span class="sxs-lookup"><span data-stu-id="8856b-115">If you queue a command with incorrect syntax into a transaction block, the block will remain open, but will automatically be discarded if you attempt to execute it with `EXEC`.</span></span> <span data-ttu-id="8856b-116">Kommandon i en transaktion som misslyckas _under_ körning (efter `EXEC` kallas) leder inte till att transaktionen avbröts eller återställts &mdash; Redis kommer fortfarande köra alla kommandon och anser att transaktionen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="8856b-116">Commands in a transaction that fail _during_ execution (after `EXEC` is called) do not cause a transaction to be aborted or rolled back &mdash; Redis will still run all of the commands and consider the transaction to have completed successfully.</span></span>

## <a name="redis-transactions-with-servicestackredis"></a><span data-ttu-id="8856b-117">Redis-transaktioner med ServiceStack.Redis</span><span class="sxs-lookup"><span data-stu-id="8856b-117">Redis transactions with ServiceStack.Redis</span></span>

<span data-ttu-id="8856b-118">**ServiceStack.Redis** är ett C#-klientbiblioteket som används vid interaktion med Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="8856b-118">**ServiceStack.Redis** is a C# client library for interacting with Azure Redis Cache.</span></span>

<span data-ttu-id="8856b-119">Transaktioner i ServiceStack.Redis skapas genom att anropa `IRedisClient.CreateTransaction()`.</span><span class="sxs-lookup"><span data-stu-id="8856b-119">Transactions in ServiceStack.Redis are created by calling `IRedisClient.CreateTransaction()`.</span></span> <span data-ttu-id="8856b-120">Det `IRedisTransaction` objekt som returneras kan ha flera kommandon i sin kö med `QueueCommand()`.</span><span class="sxs-lookup"><span data-stu-id="8856b-120">The `IRedisTransaction` object that is returned can have multiple commands queued into it with `QueueCommand()`.</span></span> <span data-ttu-id="8856b-121">Om du anropar `Commit()` på transaktionsobjektet så körs det.</span><span class="sxs-lookup"><span data-stu-id="8856b-121">Calling `Commit()` on the transaction object will execute it.</span></span>

<span data-ttu-id="8856b-122">`IRedisTransaction` objekt är disponibla och kommer automatiskt utfärda ett `DISCARD`-kommando om de tas bort innan du anropar `Commit()`.</span><span class="sxs-lookup"><span data-stu-id="8856b-122">`IRedisTransaction` objects are disposable, and will automatically issue a `DISCARD` command if disposed before calling `Commit()`.</span></span> <span data-ttu-id="8856b-123">Den här funktionen fungerar bra med C# `using`-block: Om du inte genomför en transaktion av någon anledning, kan du lita på att transaktionen kommer att tas bort automatiskt så att Redis-anslutning kan fortsätta användas.</span><span class="sxs-lookup"><span data-stu-id="8856b-123">This feature works well with C#'s `using` blocks: if you don't commit a transaction for any reason, you can trust that the transaction will automatically be discarded so that the Redis connection can continue to be used.</span></span>

## <a name="create-a-transaction-using-c-and-the-servicestackredis-client"></a><span data-ttu-id="8856b-124">Skapa en transaktion med C# och ServiceStack.Redis-klienten</span><span class="sxs-lookup"><span data-stu-id="8856b-124">Create a transaction using C# and the ServiceStack.Redis client</span></span>

<span data-ttu-id="8856b-125">Här är ett exempel på hur du använder ServiceStack.Redis för att skapa en transaktion som kan skicka ett meddelande som innehåller en bild-URL och innehållet i ett textmeddelande.</span><span class="sxs-lookup"><span data-stu-id="8856b-125">Here's an example of using ServiceStack.Redis to create a transaction that can send a message that includes a picture URL and the contents of a text message.</span></span>

```csharp
public bool SendPictureAndText(string groupChatID, string text, string pictureURL)
{
    bool transactionResult = false;

    using (RedisClient redisClient = new RedisClient(redisConnectionString))
    using (var transaction = redisClient.CreateTransaction())
    {
        //Add multiple operations to the transaction
        transaction.QueueCommand(c => c.PublishMessage(groupChatID, pictureURL));
        transaction.QueueCommand(c => c.PublishMessage(groupChatID, text));

        //Commit and get result of transaction
        transactionResult = transaction.Commit();
    }

    return transactionResult;
}
```

<span data-ttu-id="8856b-126">Transaktioner ser till att flera åtgärder utförs tillsammans utan åtgärder från andra klienter däremellan.</span><span class="sxs-lookup"><span data-stu-id="8856b-126">Transactions ensure that multiple operations are executed together without operations from other clients in between them.</span></span> <span data-ttu-id="8856b-127">Du skapar en transaktion med kommandot `MULTI`.</span><span class="sxs-lookup"><span data-stu-id="8856b-127">You create a transaction using the `MULTI` command.</span></span> <span data-ttu-id="8856b-128">Med ServiceStack.Redis, använder du `CreateTransaction()`-metoden.</span><span class="sxs-lookup"><span data-stu-id="8856b-128">With ServiceStack.Redis, you use the `CreateTransaction()` method.</span></span>